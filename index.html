<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuoteFlow - Product Price Quotation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .product-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .quote-header {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
        }
        
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .save-indicator.show {
            opacity: 1;
        }
        
        .calc-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #f3f4f6;
            color: #374151;
        }
        
        .calc-btn:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        .calc-btn:active {
            transform: translateY(0);
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .editable-title {
            background: transparent;
            border: 2px dashed transparent;
            padding: 4px 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .editable-title:hover {
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.1);
        }

        .editable-title:focus {
            outline: none;
            border-color: #f093fb;
            background: rgba(255, 255, 255, 0.2);
        }

        /* Database Modal Glass Effect */
        .database-modal-bg {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
            backdrop-filter: blur(20px);
        }

        .database-glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }

        .database-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        .database-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Real-time Statistics Animation */
        .stat-counter {
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stat-update {
            animation: statUpdate 0.5s ease;
        }

        @keyframes statUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); color: #fbbf24; }
            100% { transform: scale(1); }
        }

        /* Print Styles */
        @media print {
            body {
                background: white !important;
                color: black !important;
                font-size: 12pt;
                line-height: 1.4;
            }
            
            .gradient-bg {
                background: white !important;
            }
            
            .glass-effect {
                display: none !important;
            }
            
            .container {
                max-width: none !important;
                padding: 0 !important;
            }
            
            .lg\\:col-span-1 {
                display: none !important;
            }
            
            .lg\\:col-span-2 {
                grid-column: span 3 !important;
            }
            
            .quote-header {
                background: #f8f9fa !important;
                color: black !important;
                border: 2px solid #333 !important;
            }
            
            .bg-white {
                box-shadow: none !important;
            }
            
            #actionButtons {
                display: none !important;
            }
            
            .product-card {
                border: 1px solid #ddd !important;
                box-shadow: none !important;
                break-inside: avoid;
                margin-bottom: 10pt;
            }
            
            .text-white, .text-white\\/90 {
                color: black !important;
            }
            
            .bg-gray-50 {
                background: #f8f9fa !important;
            }
            
            .text-gray-400, .text-gray-600, .text-gray-800 {
                color: black !important;
            }
            
            .text-blue-600 {
                color: #0066cc !important;
            }
            
            .rounded-2xl, .rounded-xl, .rounded-lg {
                border-radius: 8pt !important;
            }
            
            h1, h2, h3, h4 {
                color: black !important;
            }
            
            .bg-gradient-to-r {
                background: #f8f9fa !important;
                color: black !important;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Save Indicator -->
    <div id="saveIndicator" class="save-indicator">💾 Auto-saved</div>

    <!-- Calculator Modal -->
    <div id="calculatorModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold">🧮 Calculator</h2>
                        <p class="text-white/80">Quick calculations</p>
                    </div>
                    <button onclick="closeCalculatorModal()" 
                            class="bg-white/20 hover:bg-white/30 text-white rounded-full w-10 h-10 flex items-center justify-center transition-colors">
                        ✕
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4">
                    <div id="calcDisplay" class="text-right text-2xl font-mono min-h-[40px] flex items-center justify-end">0</div>
                </div>
                
                <div class="grid grid-cols-4 gap-3">
                    <button onclick="clearCalc()" class="calc-btn bg-red-500 hover:bg-red-600 text-white col-span-2">Clear</button>
                    <button onclick="calcBackspace()" class="calc-btn bg-orange-500 hover:bg-orange-600 text-white">⌫</button>
                    <button onclick="calcInput('/')" class="calc-btn bg-blue-500 hover:bg-blue-600 text-white">÷</button>
                    
                    <button onclick="calcInput('7')" class="calc-btn">7</button>
                    <button onclick="calcInput('8')" class="calc-btn">8</button>
                    <button onclick="calcInput('9')" class="calc-btn">9</button>
                    <button onclick="calcInput('*')" class="calc-btn bg-blue-500 hover:bg-blue-600 text-white">×</button>
                    
                    <button onclick="calcInput('4')" class="calc-btn">4</button>
                    <button onclick="calcInput('5')" class="calc-btn">5</button>
                    <button onclick="calcInput('6')" class="calc-btn">6</button>
                    <button onclick="calcInput('-')" class="calc-btn bg-blue-500 hover:bg-blue-600 text-white">-</button>
                    
                    <button onclick="calcInput('1')" class="calc-btn">1</button>
                    <button onclick="calcInput('2')" class="calc-btn">2</button>
                    <button onclick="calcInput('3')" class="calc-btn">3</button>
                    <button onclick="calcInput('+')" class="calc-btn bg-blue-500 hover:bg-blue-600 text-white">+</button>
                    
                    <button onclick="calcInput('0')" class="calc-btn col-span-2">0</button>
                    <button onclick="calcInput('.')" class="calc-btn">.</button>
                    <button onclick="calcEquals()" class="calc-btn bg-green-500 hover:bg-green-600 text-white">=</button>
                </div>
                
                <div class="mt-4 flex gap-2">
                    <button onclick="useCalcResult('unitPrice')" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg text-sm">
                        Use as Unit Price
                    </button>
                    <button onclick="useCalcResult('quantity')" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white py-2 px-4 rounded-lg text-sm">
                        Use as Quantity
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="productDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold flex items-center gap-3">
                            📋 Product Details
                        </h2>
                        <p class="text-white/80 text-lg mt-1">Complete product information</p>
                    </div>
                    <button onclick="closeProductDetailsModal()" 
                            class="bg-white/20 hover:bg-white/30 text-white rounded-full w-12 h-12 flex items-center justify-center transition-colors text-xl">
                        ✕
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-140px)]" id="productDetailsContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Currency Converter Modal with Glass Design -->
    <div id="currencyModal" class="fixed inset-0 database-modal-bg z-50 hidden items-center justify-center p-4" style="display: none;">
        <div class="database-glass rounded-2xl shadow-2xl max-w-lg w-full">
            <div class="bg-gradient-to-r from-white/20 to-white/10 backdrop-blur-sm text-white p-6 border-b border-white/20">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold">💱 Currency Converter</h2>
                        <p class="text-white/80">Convert between currencies</p>
                    </div>
                    <button onclick="closeCurrencyModal()" 
                            class="bg-white/20 hover:bg-white/30 text-white rounded-full w-10 h-10 flex items-center justify-center transition-colors">
                        ✕
                    </button>
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-[calc(95vh-140px)]">
                <div class="space-y-4">
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">From Currency</label>
                        <select id="fromCurrency" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <option value="USD">🇺🇸 USD - US Dollar</option>
                            <option value="EUR">🇪🇺 EUR - Euro</option>
                            <option value="GBP">🇬🇧 GBP - British Pound</option>
                            <option value="JPY">🇯🇵 JPY - Japanese Yen</option>
                            <option value="CAD">🇨🇦 CAD - Canadian Dollar</option>
                            <option value="AUD">🇦🇺 AUD - Australian Dollar</option>
                            <option value="CHF">🇨🇭 CHF - Swiss Franc</option>
                            <option value="CNY">🇨🇳 CNY - Chinese Yuan</option>
                            <option value="INR">🇮🇳 INR - Indian Rupee</option>
                            <option value="BRL">🇧🇷 BRL - Brazilian Real</option>
                            <option value="BDT">🇧🇩 BDT - Bangladeshi Taka</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">Amount</label>
                        <input type="number" id="convertAmount" placeholder="Enter amount" step="0.01" min="0"
                               class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-400"
                               oninput="convertCurrency()">
                    </div>
                    
                    <div>
                        <label class="block text-white/80 text-sm font-medium mb-2">To Currency</label>
                        <select id="toCurrency" onchange="convertCurrency()" class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <option value="EUR">🇪🇺 EUR - Euro</option>
                            <option value="USD">🇺🇸 USD - US Dollar</option>
                            <option value="GBP">🇬🇧 GBP - British Pound</option>
                            <option value="JPY">🇯🇵 JPY - Japanese Yen</option>
                            <option value="CAD">🇨🇦 CAD - Canadian Dollar</option>
                            <option value="AUD">🇦🇺 AUD - Australian Dollar</option>
                            <option value="CHF">🇨🇭 CHF - Swiss Franc</option>
                            <option value="CNY">🇨🇳 CNY - Chinese Yuan</option>
                            <option value="INR">🇮🇳 INR - Indian Rupee</option>
                            <option value="BRL">🇧🇷 BRL - Brazilian Real</option>
                            <option value="BDT">🇧🇩 BDT - Bangladeshi Taka</option>
                        </select>
                    </div>
                    
                    <div class="bg-white/10 rounded-lg p-4 border border-white/20">
                        <div class="text-center">
                            <div class="text-sm text-white/80 mb-2">Converted Amount</div>
                            <div id="convertedAmount" class="text-2xl font-bold text-blue-300">0.00</div>
                            <div id="exchangeRate" class="text-sm text-white/60 mt-2">Exchange rate will appear here</div>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="swapCurrencies()" class="flex-1 bg-white/20 hover:bg-white/30 text-white py-2 px-4 rounded-lg backdrop-blur-sm border border-white/20">
                            🔄 Swap
                        </button>
                        <button onclick="useConvertedAmount()" class="flex-1 bg-green-500/80 hover:bg-green-600 text-white py-2 px-4 rounded-lg backdrop-blur-sm">
                            Use as Unit Price
                        </button>
                    </div>
                    
                    <div class="text-xs text-white/60 text-center">
                        💡 Exchange rates are approximate and for reference only
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Library Modal -->
    <div id="productLibraryModal" class="fixed inset-0 database-modal-bg z-50 hidden items-center justify-center p-4" style="display: none;">
        <div class="database-glass rounded-3xl max-w-6xl w-full max-h-[95vh] overflow-hidden">
            <div class="bg-gradient-to-r from-white/20 to-white/10 backdrop-blur-sm text-white p-8 border-b border-white/20">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold flex items-center gap-3">
                            📦 Product Library
                        </h2>
                        <p class="text-white/80 text-lg mt-1">Browse and add products from our extensive catalog</p>
                    </div>
                    <button onclick="closeProductLibraryModal()" 
                            class="bg-white/20 hover:bg-white/30 text-white rounded-full w-12 h-12 flex items-center justify-center transition-colors text-xl">
                        ✕
                    </button>
                </div>
            </div>
            
            <div class="p-8 overflow-y-auto max-h-[calc(95vh-140px)]">
                <!-- Search and Filter Controls -->
                <div class="mb-6 space-y-4">
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <input type="text" id="librarySearchInput" placeholder="Search products by name, category, or description..." 
                                   class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-pink-400 backdrop-blur-sm"
                                   oninput="filterLibraryProducts(this.value)">
                        </div>
                        <select id="categoryFilter" onchange="filterByCategory(this.value)" 
                                class="px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-pink-400 backdrop-blur-sm">
                            <option value="" style="background: rgba(0,0,0,0.8); color: white;">All Categories</option>
                            <option value="Electronics" style="background: rgba(0,0,0,0.8); color: white;">📱 Electronics</option>
                            <option value="Clothing" style="background: rgba(0,0,0,0.8); color: white;">👕 Clothing</option>
                            <option value="Home & Garden" style="background: rgba(0,0,0,0.8); color: white;">🏠 Home & Garden</option>
                            <option value="Sports" style="background: rgba(0,0,0,0.8); color: white;">⚽ Sports</option>
                            <option value="Books" style="background: rgba(0,0,0,0.8); color: white;">📚 Books</option>
                            <option value="Automotive" style="background: rgba(0,0,0,0.8); color: white;">🚗 Automotive</option>
                            <option value="Health & Beauty" style="background: rgba(0,0,0,0.8); color: white;">💄 Health & Beauty</option>
                            <option value="Food & Beverages" style="background: rgba(0,0,0,0.8); color: white;">🍕 Food & Beverages</option>
                            <option value="Office Supplies" style="background: rgba(0,0,0,0.8); color: white;">📎 Office Supplies</option>
                            <option value="Toys & Games" style="background: rgba(0,0,0,0.8); color: white;">🎮 Toys & Games</option>
                        </select>
                    </div>
                </div>
                
                <!-- Product Library Grid -->
                <div id="productLibraryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Products will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-t-2xl">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold">🔗 Share Quote</h2>
                        <p class="text-white/80">Share your quote with others</p>
                    </div>
                    <button onclick="closeShareModal()" 
                            class="bg-white/20 hover:bg-white/30 text-white rounded-full w-10 h-10 flex items-center justify-center transition-colors">
                        ✕
                    </button>
                </div>
            </div>
            
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-gray-700 text-sm font-medium mb-2">Share Link</label>
                    <div class="flex gap-2">
                        <input type="text" id="shareLink" readonly 
                               class="flex-1 px-4 py-3 rounded-lg border border-gray-300 bg-gray-50 text-gray-700 focus:outline-none">
                        <button onclick="copyShareLink()" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition-colors">
                            📋 Copy
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="shareViaEmail()" 
                            class="bg-red-500 hover:bg-red-600 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                        📧 Email
                    </button>
                    <button onclick="shareViaWhatsApp()" 
                            class="bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                        📱 WhatsApp
                    </button>
                </div>
                
                <div class="text-center">
                    <button onclick="generateQRCode()" 
                            class="bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2 mx-auto">
                        📱 Generate QR Code
                    </button>
                </div>
                
                <div id="qrCodeContainer" class="hidden text-center">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <div id="qrCode" class="mx-auto"></div>
                        <p class="text-sm text-gray-600 mt-2">Scan to view quote</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Modal with Glass Effect -->
    <div id="databaseModal" class="fixed inset-0 database-modal-bg z-50 hidden items-center justify-center p-4" style="display: none;">
        <div class="database-glass rounded-3xl max-w-7xl w-full max-h-[95vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-white/20 to-white/10 backdrop-blur-sm text-white p-8 border-b border-white/20">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold flex items-center gap-3">
                            🗄️ Database Viewer
                        </h2>
                        <p class="text-white/80 text-lg mt-1">All stored data and statistics</p>
                    </div>
                    <button onclick="closeDatabaseModal()" 
                            class="bg-white/20 hover:bg-white/30 text-white rounded-full w-12 h-12 flex items-center justify-center transition-colors text-xl">
                        ✕
                    </button>
                </div>
            </div>
            
            <!-- Modal Content -->
            <div class="p-8 overflow-y-auto max-h-[calc(95vh-140px)]">
                <div id="databaseContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Fixed Header with All Features -->
    <div class="fixed top-0 left-0 right-0 z-40 bg-gradient-to-r from-indigo-500/95 to-purple-600/95 backdrop-blur-lg border-b border-white/20">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- App Title -->
                <div class="flex items-center gap-3">
                    <h1 class="text-2xl font-bold text-white flex items-center gap-2">
                        💼 
                        <input type="text" id="appTitle" value="QuoteFlow" 
                               class="editable-title text-2xl font-bold text-white bg-transparent border-2 border-dashed border-transparent focus:border-pink-400 focus:bg-white/10 rounded-lg px-2"
                               onchange="saveAppTitle()" placeholder="Enter App Name">
                    </h1>
                </div>
                
                <!-- Feature Buttons -->
                <div class="flex items-center gap-2 flex-wrap">
                    <button onclick="showProductLibrary()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        📦 Library
                    </button>
                    <button onclick="showCalculator()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        🧮 Calculator
                    </button>
                    <button onclick="showCurrencyConverter()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        💱 Currency
                    </button>
                    <button onclick="shareQuote()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        🔗 Share
                    </button>
                    <button onclick="printQuote()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        🖨️ Print
                    </button>
                    <button onclick="downloadQuote()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        📄 Download
                    </button>
                    <button onclick="downloadPDF()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        📑 PDF
                    </button>
                    <button onclick="showDatabase()" 
                            class="bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center gap-2 backdrop-blur-sm border border-white/20 text-sm">
                        🗄️ Database
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8" style="margin-top: 80px;">
        <!-- Header with subtitle -->
        <div class="text-center mb-8">
            <p class="text-white/80 text-lg">Professional Product Price Quotations</p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Product Entry Form -->
            <div class="lg:col-span-1">
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                        ➕ Add Product
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Product Name</label>
                            <input type="text" id="productName" placeholder="Enter product name" 
                                   class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400">
                        </div>
                        
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Serial Number (Auto-generated if empty)</label>
                            <input type="text" id="serialNumber" placeholder="Leave empty for auto: QF2024-001-001" 
                                   class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">Quantity</label>
                                <input type="number" id="quantity" placeholder="1" min="1" 
                                       class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400">
                            </div>
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">Unit Price ($)</label>
                                <input type="number" id="unitPrice" placeholder="0.00" step="0.01" min="0" 
                                       class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">Weight</label>
                                <input type="number" id="weight" placeholder="0.0" step="0.1" min="0" 
                                       class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400">
                            </div>
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">Weight Unit</label>
                                <select id="weightUnit" 
                                        class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-pink-400">
                                    <option value="kg" style="background: rgba(0,0,0,0.8); color: white;">kg - Kilograms</option>
                                    <option value="g" style="background: rgba(0,0,0,0.8); color: white;">g - Grams</option>
                                    <option value="lb" style="background: rgba(0,0,0,0.8); color: white;">lb - Pounds</option>
                                    <option value="oz" style="background: rgba(0,0,0,0.8); color: white;">oz - Ounces</option>
                                    <option value="t" style="background: rgba(0,0,0,0.8); color: white;">t - Tonnes</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Product Category</label>
                            <select id="productCategory" 
                                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-pink-400">
                                <option value="" style="background: rgba(0,0,0,0.8); color: white;">Select Category</option>
                                <option value="Electronics" style="background: rgba(0,0,0,0.8); color: white;">📱 Electronics</option>
                                <option value="Clothing" style="background: rgba(0,0,0,0.8); color: white;">👕 Clothing</option>
                                <option value="Home & Garden" style="background: rgba(0,0,0,0.8); color: white;">🏠 Home & Garden</option>
                                <option value="Sports" style="background: rgba(0,0,0,0.8); color: white;">⚽ Sports</option>
                                <option value="Books" style="background: rgba(0,0,0,0.8); color: white;">📚 Books</option>
                                <option value="Automotive" style="background: rgba(0,0,0,0.8); color: white;">🚗 Automotive</option>
                                <option value="Health & Beauty" style="background: rgba(0,0,0,0.8); color: white;">💄 Health & Beauty</option>
                                <option value="Food & Beverages" style="background: rgba(0,0,0,0.8); color: white;">🍕 Food & Beverages</option>
                                <option value="Office Supplies" style="background: rgba(0,0,0,0.8); color: white;">📎 Office Supplies</option>
                                <option value="Toys & Games" style="background: rgba(0,0,0,0.8); color: white;">🎮 Toys & Games</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Individual Calculation Method</label>
                            <select id="productCalculationMethod" 
                                    class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-pink-400">
                                <option value="" style="background: rgba(0,0,0,0.8); color: white;">Use Global Method</option>
                                <option value="standard" style="background: rgba(0,0,0,0.8); color: white;">📊 Standard (Subtotal + Tax)</option>
                                <option value="discount" style="background: rgba(0,0,0,0.8); color: white;">💰 With Discount</option>
                                <option value="markup" style="background: rgba(0,0,0,0.8); color: white;">📈 Cost + Markup</option>
                                <option value="tiered" style="background: rgba(0,0,0,0.8); color: white;">🎯 Tiered Pricing</option>
                                <option value="bulk" style="background: rgba(0,0,0,0.8); color: white;">📦 Bulk Discount</option>
                                <option value="custom" style="background: rgba(0,0,0,0.8); color: white;">⚙️ Custom Formula</option>
                            </select>
                            <div class="text-xs text-white/60 mt-1">
                                💡 Override global calculation method for this product only
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">Single Box Size (cm)</label>
                                <input type="text" id="boxSize" placeholder="L x W x H (e.g., 30x20x15)" 
                                       class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400">
                            </div>
                            <div>
                                <label class="block text-white/80 text-sm font-medium mb-2">Box Quantity</label>
                                <input type="number" id="boxQuantity" placeholder="1" min="1" 
                                       class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Product Color (Optional)</label>
                            <div class="space-y-3">
                                <div class="flex gap-3">
                                    <div class="flex-1">
                                        <input type="color" id="productColor" value="#3B82F6" 
                                               class="w-full h-12 rounded-lg border border-white/20 bg-white/10 cursor-pointer">
                                    </div>
                                    <div class="flex-1">
                                        <select id="colorPreset" onchange="setPresetColor()" 
                                                class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-pink-400">
                                            <option value="">Quick Colors</option>
                                            <option value="#EF4444">🔴 Red</option>
                                            <option value="#3B82F6">🔵 Blue</option>
                                            <option value="#10B981">🟢 Green</option>
                                            <option value="#F59E0B">🟡 Yellow</option>
                                            <option value="#8B5CF6">🟣 Purple</option>
                                            <option value="#F97316">🟠 Orange</option>
                                            <option value="#EC4899">🩷 Pink</option>
                                            <option value="#6B7280">⚫ Gray</option>
                                            <option value="#000000">⚫ Black</option>
                                            <option value="#FFFFFF">⚪ White</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Bulk Color Input -->
                                <div class="relative">
                                    <input type="text" id="bulkColorInput" placeholder="Type color names: red, blue, green, yellow..." 
                                           class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400"
                                           onkeypress="handleBulkColorInput(event)" oninput="showColorSuggestions(this.value)">
                                    <div id="colorSuggestions" class="hidden absolute top-full left-0 right-0 bg-white rounded-lg shadow-lg border border-gray-200 mt-1 max-h-40 overflow-y-auto z-10"></div>
                                </div>
                                <div class="text-xs text-white/60">
                                    💡 Type color names separated by commas, then press Enter to convert them to hex colors
                                </div>
                            </div>
                        </div>
                        
                        <!-- Multiple Photos Section -->
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Product Photos (Multiple)</label>
                            <div class="space-y-3">
                                <div class="relative">
                                    <input type="file" id="productPhotos" accept="image/*" multiple
                                           class="hidden" onchange="handleMultiplePhotosUpload(this)">
                                    <button type="button" onclick="document.getElementById('productPhotos').click()" 
                                            class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white/80 hover:bg-white/20 transition-colors flex items-center justify-center gap-2">
                                        📷 Choose Photos (Multiple)
                                    </button>
                                </div>
                                
                                <!-- Photo Gallery -->
                                <div id="photoGallery" class="hidden">
                                    <div class="text-white/80 text-sm mb-2">Selected Photos:</div>
                                    <div id="photoGrid" class="photo-gallery"></div>
                                    <button type="button" onclick="clearAllPhotos()" 
                                            class="mt-2 w-full bg-red-500/80 hover:bg-red-600 text-white py-2 px-4 rounded-lg text-sm transition-colors">
                                        🗑️ Clear All Photos
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Description (Optional)</label>
                            <textarea id="description" placeholder="Product description..." rows="2"
                                      class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400 resize-none"></textarea>
                        </div>
                        
                        <button onclick="addProduct()" 
                                class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                            Add to Quote
                        </button>
                        
                        <button onclick="showProductLibrary()" 
                                class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 mt-2">
                            📦 Browse Product Library
                        </button>
                        
                        <button id="cancelEditBtn" onclick="cancelEdit()" 
                                class="w-full bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors mt-2 hidden">
                            Cancel Edit
                        </button>
                    </div>
                </div>

                <!-- Quote Settings -->
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                        ⚙️ Quote Settings
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="glass-effect rounded-xl p-4 border border-white/30 backdrop-blur-md">
                            <label class="block text-white/90 text-sm font-medium mb-3 flex items-center gap-2">
                                💱 Display Currency
                            </label>
                            <select id="displayCurrency" onchange="updateCurrency(); saveData();"
                                    class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-pink-400 backdrop-blur-sm">
                                <option value="USD" style="background: rgba(0,0,0,0.8); color: white;">🇺🇸 USD - US Dollar</option>
                                <option value="EUR" style="background: rgba(0,0,0,0.8); color: white;">🇪🇺 EUR - Euro</option>
                                <option value="GBP" style="background: rgba(0,0,0,0.8); color: white;">🇬🇧 GBP - British Pound</option>
                                <option value="JPY" style="background: rgba(0,0,0,0.8); color: white;">🇯🇵 JPY - Japanese Yen</option>
                                <option value="CAD" style="background: rgba(0,0,0,0.8); color: white;">🇨🇦 CAD - Canadian Dollar</option>
                                <option value="AUD" style="background: rgba(0,0,0,0.8); color: white;">🇦🇺 AUD - Australian Dollar</option>
                                <option value="CHF" style="background: rgba(0,0,0,0.8); color: white;">🇨🇭 CHF - Swiss Franc</option>
                                <option value="CNY" style="background: rgba(0,0,0,0.8); color: white;">🇨🇳 CNY - Chinese Yuan</option>
                                <option value="INR" style="background: rgba(0,0,0,0.8); color: white;">🇮🇳 INR - Indian Rupee</option>
                                <option value="BRL" style="background: rgba(0,0,0,0.8); color: white;">🇧🇷 BRL - Brazilian Real</option>
                                <option value="BDT" style="background: rgba(0,0,0,0.8); color: white;">🇧🇩 BDT - Bangladeshi Taka</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Tax Rate (%)</label>
                            <input type="number" id="taxRate" value="8.5" step="0.1" min="0" max="100"
                                   class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400"
                                   onchange="updateTotals(); saveData();">
                        </div>
                        
                        <div>
                            <label class="block text-white/80 text-sm font-medium mb-2">Discount (%)</label>
                            <input type="number" id="discount" value="0" step="0.1" min="0" max="100"
                                   class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-pink-400"
                                   onchange="updateTotals(); saveData();">
                        </div>
                        
                        <button onclick="showCurrencyConverter()" 
                                class="w-full bg-gradient-to-r from-blue-500 to-cyan-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2">
                            💱 Currency Converter
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quote Display -->
            <div class="lg:col-span-2">
                <div class="glass-effect rounded-2xl shadow-2xl overflow-hidden backdrop-blur-lg border border-white/30">
                    <!-- Quote Header -->
                    <div class="quote-header p-6 text-white glass-effect border-b border-white/20">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h2 class="text-2xl font-bold mb-1">QUOTATION</h2>
                                <p class="text-white/90">Quote #<span id="quoteNumber">QF-2024-001</span></p>
                            </div>
                            <div class="text-right">
                                <p class="text-white/90">Date: <span id="quoteDate"></span></p>
                                <p class="text-white/90">Valid Until: <span id="validDate"></span></p>
                            </div>
                        </div>
                        
                        <!-- Real-time Statistics -->
                        <div class="glass-effect rounded-xl p-4 border border-white/30 backdrop-blur-md mb-4">
                            <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                                📊 Real-time Statistics
                            </h3>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-300 stat-counter" id="realTimeItems">0</div>
                                    <div class="text-xs text-white/70">Total Items</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-300 stat-counter" id="realTimeQuantity">0</div>
                                    <div class="text-xs text-white/70">Total Quantity</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-300 stat-counter" id="realTimeAvgPrice">$0.00</div>
                                    <div class="text-xs text-white/70">Avg Price</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-yellow-300 stat-counter" id="realTimeTotalValue">$0.00</div>
                                    <div class="text-xs text-white/70">Total Value</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Search Products Section -->
                        <div class="glass-effect rounded-xl p-4 border border-white/30 backdrop-blur-md">
                            <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                                🔍 Search Products
                            </h3>
                            
                            <div class="space-y-3">
                                <div>
                                    <input type="text" id="searchInput" placeholder="Search by name, serial, or description..." 
                                           class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-pink-400 backdrop-blur-sm"
                                           oninput="searchProducts(this.value)">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Global Calculation Method -->
                        <div class="glass-effect rounded-xl p-4 border border-white/30 backdrop-blur-md">
                            <h3 class="text-lg font-semibold text-white mb-3 flex items-center gap-2">
                                🧮 Global Calculation Method
                            </h3>
                            
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-white/80 text-sm font-medium mb-2">Default Calculation Method</label>
                                    <select id="calculationMethod" onchange="updateCalculationMethod(); updateTotals(); saveData();"
                                            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-pink-400 backdrop-blur-sm">
                                        <option value="standard" style="background: rgba(0,0,0,0.8); color: white;">📊 Standard (Subtotal + Tax)</option>
                                        <option value="discount" style="background: rgba(0,0,0,0.8); color: white;">💰 With Discount</option>
                                        <option value="markup" style="background: rgba(0,0,0,0.8); color: white;">📈 Cost + Markup</option>
                                        <option value="tiered" style="background: rgba(0,0,0,0.8); color: white;">🎯 Tiered Pricing</option>
                                        <option value="bulk" style="background: rgba(0,0,0,0.8); color: white;">📦 Bulk Discount</option>
                                        <option value="custom" style="background: rgba(0,0,0,0.8); color: white;">⚙️ Custom Formula</option>
                                    </select>
                                </div>
                                <div class="text-xs text-white/60">
                                    💡 This applies to all products. Individual products can override this setting.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Products List -->
                    <div class="p-6 bg-white/10 backdrop-blur-sm">
                        <div id="productsList" class="space-y-3 mb-6">
                            <div class="text-center py-12 text-white/60">
                                <div class="text-6xl mb-4">📋</div>
                                <p class="text-lg">No products added yet</p>
                                <p class="text-sm">Add your first product to get started</p>
                            </div>
                        </div>

                        <!-- Totals Section -->
                        <div id="totalsSection" class="hidden border-t border-white/20 pt-6">
                            <div class="glass-effect rounded-xl p-6 border border-white/20 backdrop-blur-sm">
                                <div class="space-y-4">
                                    <div class="flex justify-between text-white/90">
                                        <span>Subtotal:</span>
                                        <span id="subtotal">$0.00</span>
                                    </div>
                                    
                                    <!-- Interactive Discount Control -->
                                    <div class="flex justify-between items-center text-white/90">
                                        <span>Discount:</span>
                                        <div class="flex items-center gap-2">
                                            <input type="number" id="quickDiscount" value="0" step="0.1" min="0" max="100"
                                                   class="w-16 px-2 py-1 rounded bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-1 focus:ring-pink-400"
                                                   onchange="updateQuickDiscount(); updateTotals(); saveData();">
                                            <span class="text-sm">%</span>
                                            <span id="discountAmount" class="ml-2">-$0.00</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Interactive Tax Control -->
                                    <div class="flex justify-between items-center text-white/90">
                                        <span>Tax:</span>
                                        <div class="flex items-center gap-2">
                                            <input type="number" id="quickTax" value="8.5" step="0.1" min="0" max="100"
                                                   class="w-16 px-2 py-1 rounded bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:ring-1 focus:ring-pink-400"
                                                   onchange="updateQuickTax(); updateTotals(); saveData();">
                                            <span class="text-sm">%</span>
                                            <span id="taxAmount" class="ml-2">$0.00</span>
                                        </div>
                                    </div>
                                    

                                    
                                    <div class="border-t border-white/20 pt-3">
                                        <div class="flex justify-between text-xl font-bold text-white">
                                            <span>Total:</span>
                                            <span id="total">$0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div id="actionButtons" class="hidden mt-6 grid grid-cols-2 lg:grid-cols-4 gap-3">
                            <button onclick="clearQuote()" 
                                    class="bg-gray-500 bg-opacity-70 text-white font-semibold py-3 px-4 rounded-lg hover:bg-gray-600 hover:bg-opacity-80 transition-all duration-300 text-sm">
                                🗑️ Clear Quote
                            </button>
                            <button onclick="shareQuote()" 
                                    class="bg-gradient-to-r from-green-500 to-emerald-600 bg-opacity-70 text-white font-semibold py-3 px-4 rounded-lg hover:from-green-600 hover:to-emerald-700 hover:bg-opacity-80 transition-all duration-300 text-sm">
                                🔗 Share Quote
                            </button>
                            <button onclick="printQuote()" 
                                    class="bg-gradient-to-r from-purple-500 to-pink-600 bg-opacity-70 text-white font-semibold py-3 px-4 rounded-lg hover:from-purple-600 hover:to-pink-700 hover:bg-opacity-80 transition-all duration-300 text-sm">
                                🖨️ Print Quote
                            </button>
                            <button onclick="downloadQuote()" 
                                    class="bg-gradient-to-r from-blue-500 to-indigo-600 bg-opacity-70 text-white font-semibold py-3 px-4 rounded-lg hover:from-blue-600 hover:to-indigo-700 hover:bg-opacity-80 transition-all duration-300 text-sm">
                                📄 Download Quote
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let quoteCounter = 1;
        let currentPhotos = [];
        let serialCounter = 1;
        let editingProductId = null;
        let appTitle = 'QuoteFlow';
        let currentCurrency = 'USD';
        let productLibrary = [];
        let filteredLibrary = [];

        // Currency symbols mapping
        const currencySymbols = {
            'USD': '$', 'EUR': '€', 'GBP': '£', 'JPY': '¥', 'CAD': 'C$',
            'AUD': 'A$', 'CHF': 'CHF', 'CNY': '¥', 'INR': '₹', 'BRL': 'R$', 'BDT': '৳'
        };

        // Format currency with proper symbol
        function formatCurrency(amount) {
            const symbol = currencySymbols[currentCurrency] || '$';
            return `${symbol}${amount.toFixed(2)}`;
        }

        // Update currency display
        function updateCurrency() {
            currentCurrency = document.getElementById('displayCurrency').value;
            updateRealTimeStats();
            updateTotals();
            renderProducts();
        }

        // Update real-time statistics
        function updateRealTimeStats() {
            const totalItems = products.length;
            const totalQuantity = products.reduce((sum, product) => sum + product.quantity, 0);
            const totalValue = products.reduce((sum, product) => sum + product.total, 0);
            const avgPrice = totalItems > 0 ? totalValue / totalItems : 0;

            // Update with animation
            updateStatWithAnimation('realTimeItems', totalItems);
            updateStatWithAnimation('realTimeQuantity', totalQuantity);
            updateStatWithAnimation('realTimeAvgPrice', formatCurrency(avgPrice));
            updateStatWithAnimation('realTimeTotalValue', formatCurrency(totalValue));
        }

        // Update individual stat with animation
        function updateStatWithAnimation(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('stat-update');
                element.textContent = value;
                
                setTimeout(() => {
                    element.classList.remove('stat-update');
                }, 500);
            }
        }

        // Generate automatic serial number
        function generateAutoSerialNumber() {
            const year = new Date().getFullYear();
            const quoteNum = document.getElementById('quoteNumber').textContent.split('-')[2];
            const serialNum = String(serialCounter).padStart(3, '0');
            serialCounter++;
            return `QF${year}-${quoteNum}-${serialNum}`;
        }

        // Initialize dates and load saved data
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const validUntil = new Date(today.getTime() + (30 * 24 * 60 * 60 * 1000)); // 30 days from now
            
            document.getElementById('quoteDate').textContent = today.toLocaleDateString();
            document.getElementById('validDate').textContent = validUntil.toLocaleDateString();
            
            initializeProductLibrary();
            loadData();
            updateRealTimeStats();
        });

        // Initialize product library with 100+ products
        function initializeProductLibrary() {
            productLibrary = [
                // Electronics (20 products)
                { id: 1, name: 'iPhone 15 Pro', category: 'Electronics', price: 999.99, description: 'Latest Apple smartphone with titanium design', boxSize: '16x8x1', boxQuantity: 1 },
                { id: 2, name: 'Samsung Galaxy S24', category: 'Electronics', price: 899.99, description: 'Premium Android smartphone', boxSize: '16x8x1', boxQuantity: 1 },
                { id: 3, name: 'MacBook Air M3', category: 'Electronics', price: 1299.99, description: '13-inch laptop with M3 chip', boxSize: '35x25x2', boxQuantity: 1 },
                { id: 4, name: 'iPad Pro 12.9"', category: 'Electronics', price: 1099.99, description: 'Professional tablet with M2 chip', boxSize: '30x22x1', boxQuantity: 1 },
                { id: 5, name: 'Sony WH-1000XM5', category: 'Electronics', price: 399.99, description: 'Noise-canceling wireless headphones', boxSize: '25x20x10', boxQuantity: 1 },
                { id: 6, name: 'Dell XPS 13', category: 'Electronics', price: 1199.99, description: 'Ultra-thin Windows laptop', boxSize: '35x25x2', boxQuantity: 1 },
                { id: 7, name: 'Nintendo Switch OLED', category: 'Electronics', price: 349.99, description: 'Gaming console with OLED screen', boxSize: '25x15x5', boxQuantity: 1 },
                { id: 8, name: 'Apple Watch Series 9', category: 'Electronics', price: 429.99, description: 'Smart watch with health monitoring', boxSize: '12x10x3', boxQuantity: 1 },
                { id: 9, name: 'Samsung 55" QLED TV', category: 'Electronics', price: 1299.99, description: '4K Smart TV with quantum dot technology', boxSize: '130x80x15', boxQuantity: 1 },
                { id: 10, name: 'Canon EOS R6', category: 'Electronics', price: 2499.99, description: 'Mirrorless camera for professionals', boxSize: '30x25x15', boxQuantity: 1 },
                { id: 11, name: 'Bose SoundLink Revolve+', category: 'Electronics', price: 329.99, description: 'Portable Bluetooth speaker', boxSize: '20x20x15', boxQuantity: 1 },
                { id: 12, name: 'Microsoft Surface Pro 9', category: 'Electronics', price: 1099.99, description: '2-in-1 tablet and laptop', boxSize: '30x22x1', boxQuantity: 1 },
                { id: 13, name: 'Google Pixel 8 Pro', category: 'Electronics', price: 999.99, description: 'AI-powered Android phone', boxSize: '16x8x1', boxQuantity: 1 },
                { id: 14, name: 'AirPods Pro 2nd Gen', category: 'Electronics', price: 249.99, description: 'Wireless earbuds with ANC', boxSize: '10x8x5', boxQuantity: 1 },
                { id: 15, name: 'Tesla Model Y Charger', category: 'Electronics', price: 599.99, description: 'Home charging station', boxSize: '40x30x10', boxQuantity: 1 },
                { id: 16, name: 'Dyson V15 Detect', category: 'Electronics', price: 749.99, description: 'Cordless vacuum cleaner', boxSize: '120x25x25', boxQuantity: 1 },
                { id: 17, name: 'Ring Video Doorbell Pro', category: 'Electronics', price: 249.99, description: 'Smart doorbell with HD video', boxSize: '15x10x5', boxQuantity: 1 },
                { id: 18, name: 'Fitbit Charge 5', category: 'Electronics', price: 179.99, description: 'Advanced fitness tracker', boxSize: '12x8x3', boxQuantity: 1 },
                { id: 19, name: 'Amazon Echo Dot 5th Gen', category: 'Electronics', price: 49.99, description: 'Smart speaker with Alexa', boxSize: '15x15x10', boxQuantity: 1 },
                { id: 20, name: 'GoPro HERO12 Black', category: 'Electronics', price: 399.99, description: 'Action camera for adventures', boxSize: '12x8x5', boxQuantity: 1 },

                // Clothing (15 products)
                { id: 21, name: 'Nike Air Max 270', category: 'Clothing', price: 149.99, description: 'Comfortable running shoes', boxSize: '35x25x12', boxQuantity: 1 },
                { id: 22, name: 'Levi\'s 501 Original Jeans', category: 'Clothing', price: 89.99, description: 'Classic straight-leg jeans', boxSize: '30x25x5', boxQuantity: 1 },
                { id: 23, name: 'Adidas Ultraboost 22', category: 'Clothing', price: 189.99, description: 'Premium running shoes', boxSize: '35x25x12', boxQuantity: 1 },
                { id: 24, name: 'North Face Puffer Jacket', category: 'Clothing', price: 299.99, description: 'Warm winter jacket', boxSize: '40x30x15', boxQuantity: 1 },
                { id: 25, name: 'Champion Hoodie', category: 'Clothing', price: 59.99, description: 'Comfortable cotton hoodie', boxSize: '35x25x8', boxQuantity: 1 },
                { id: 26, name: 'Ray-Ban Aviator Sunglasses', category: 'Clothing', price: 179.99, description: 'Classic aviator style', boxSize: '20x8x5', boxQuantity: 1 },
                { id: 27, name: 'Patagonia Fleece Vest', category: 'Clothing', price: 129.99, description: 'Outdoor fleece vest', boxSize: '30x25x8', boxQuantity: 1 },
                { id: 28, name: 'Converse Chuck Taylor All Star', category: 'Clothing', price: 65.99, description: 'Classic canvas sneakers', boxSize: '35x25x12', boxQuantity: 1 },
                { id: 29, name: 'Under Armour Performance Polo', category: 'Clothing', price: 49.99, description: 'Moisture-wicking polo shirt', boxSize: '30x25x3', boxQuantity: 1 },
                { id: 30, name: 'Timberland Work Boots', category: 'Clothing', price: 189.99, description: 'Durable work boots', boxSize: '35x25x15', boxQuantity: 1 },
                { id: 31, name: 'Calvin Klein Underwear Set', category: 'Clothing', price: 39.99, description: 'Cotton underwear 3-pack', boxSize: '25x20x5', boxQuantity: 1 },
                { id: 32, name: 'Tommy Hilfiger Dress Shirt', category: 'Clothing', price: 79.99, description: 'Formal dress shirt', boxSize: '30x25x3', boxQuantity: 1 },
                { id: 33, name: 'Vans Old Skool Sneakers', category: 'Clothing', price: 69.99, description: 'Skateboarding shoes', boxSize: '35x25x12', boxQuantity: 1 },
                { id: 34, name: 'Columbia Rain Jacket', category: 'Clothing', price: 119.99, description: 'Waterproof rain jacket', boxSize: '35x25x8', boxQuantity: 1 },
                { id: 35, name: 'Polo Ralph Lauren T-Shirt', category: 'Clothing', price: 45.99, description: 'Premium cotton t-shirt', boxSize: '30x25x3', boxQuantity: 1 },

                // Home & Garden (15 products)
                { id: 36, name: 'KitchenAid Stand Mixer', category: 'Home & Garden', price: 379.99, description: 'Professional stand mixer', boxSize: '40x35x30', boxQuantity: 1 },
                { id: 37, name: 'Instant Pot Duo 7-in-1', category: 'Home & Garden', price: 99.99, description: 'Multi-use pressure cooker', boxSize: '35x35x30', boxQuantity: 1 },
                { id: 38, name: 'Ninja Blender Pro', category: 'Home & Garden', price: 149.99, description: 'High-performance blender', boxSize: '25x20x40', boxQuantity: 1 },
                { id: 39, name: 'Shark Navigator Vacuum', category: 'Home & Garden', price: 179.99, description: 'Upright vacuum cleaner', boxSize: '80x30x25', boxQuantity: 1 },
                { id: 40, name: 'Philips Air Fryer XXL', category: 'Home & Garden', price: 299.99, description: 'Large capacity air fryer', boxSize: '40x30x35', boxQuantity: 1 },
                { id: 41, name: 'Keurig K-Elite Coffee Maker', category: 'Home & Garden', price: 169.99, description: 'Single-serve coffee maker', boxSize: '30x25x35', boxQuantity: 1 },
                { id: 42, name: 'Weber Genesis Gas Grill', category: 'Home & Garden', price: 899.99, description: '3-burner gas grill', boxSize: '150x60x120', boxQuantity: 1 },
                { id: 43, name: 'Roomba i7+ Robot Vacuum', category: 'Home & Garden', price: 799.99, description: 'Self-emptying robot vacuum', boxSize: '40x40x15', boxQuantity: 1 },
                { id: 44, name: 'Nest Learning Thermostat', category: 'Home & Garden', price: 249.99, description: 'Smart programmable thermostat', boxSize: '15x15x5', boxQuantity: 1 },
                { id: 45, name: 'Cuisinart Food Processor', category: 'Home & Garden', price: 199.99, description: '14-cup food processor', boxSize: '30x25x35', boxQuantity: 1 },
                { id: 46, name: 'Black+Decker Drill Set', category: 'Home & Garden', price: 89.99, description: 'Cordless drill with bits', boxSize: '35x25x15', boxQuantity: 1 },
                { id: 47, name: 'Honeywell Air Purifier', category: 'Home & Garden', price: 199.99, description: 'HEPA air purifier', boxSize: '30x20x60', boxQuantity: 1 },
                { id: 48, name: 'Breville Espresso Machine', category: 'Home & Garden', price: 699.99, description: 'Semi-automatic espresso maker', boxSize: '35x30x40', boxQuantity: 1 },
                { id: 49, name: 'Lodge Cast Iron Skillet', category: 'Home & Garden', price: 34.99, description: '12-inch cast iron pan', boxSize: '35x35x8', boxQuantity: 1 },
                { id: 50, name: 'Bissell CrossWave Pet Pro', category: 'Home & Garden', price: 249.99, description: 'Wet dry vacuum for pets', boxSize: '80x30x25', boxQuantity: 1 },

                // Sports (10 products)
                { id: 51, name: 'Peloton Bike+', category: 'Sports', price: 2495.00, description: 'Interactive exercise bike', boxSize: '150x60x120', boxQuantity: 1 },
                { id: 52, name: 'NordicTrack Treadmill', category: 'Sports', price: 1999.99, description: 'Commercial-grade treadmill', boxSize: '200x90x150', boxQuantity: 1 },
                { id: 53, name: 'Bowflex Adjustable Dumbbells', category: 'Sports', price: 549.99, description: 'Space-saving dumbbells', boxSize: '60x30x25', boxQuantity: 2 },
                { id: 54, name: 'Yeti Rambler Tumbler', category: 'Sports', price: 39.99, description: 'Insulated stainless steel tumbler', boxSize: '15x10x25', boxQuantity: 1 },
                { id: 55, name: 'Wilson Tennis Racket Pro', category: 'Sports', price: 199.99, description: 'Professional tennis racket', boxSize: '70x30x5', boxQuantity: 1 },
                { id: 56, name: 'Spalding Basketball Official', category: 'Sports', price: 59.99, description: 'Official size basketball', boxSize: '25x25x25', boxQuantity: 1 },
                { id: 57, name: 'Coleman Camping Tent 4-Person', category: 'Sports', price: 149.99, description: 'Waterproof camping tent', boxSize: '60x20x20', boxQuantity: 1 },
                { id: 58, name: 'Hydro Flask Water Bottle', category: 'Sports', price: 44.99, description: '32oz insulated water bottle', boxSize: '15x10x30', boxQuantity: 1 },
                { id: 59, name: 'Garmin Forerunner 945', category: 'Sports', price: 599.99, description: 'GPS running watch', boxSize: '15x12x8', boxQuantity: 1 },
                { id: 60, name: 'RTIC Cooler 45 Quart', category: 'Sports', price: 199.99, description: 'Heavy-duty ice cooler', boxSize: '70x40x40', boxQuantity: 1 },

                // Books (10 products)
                { id: 61, name: 'The Psychology of Money', category: 'Books', price: 16.99, description: 'Financial wisdom book', boxSize: '20x13x3', boxQuantity: 1 },
                { id: 62, name: 'Atomic Habits', category: 'Books', price: 18.99, description: 'Habit formation guide', boxSize: '20x13x3', boxQuantity: 1 },
                { id: 63, name: 'Sapiens: A Brief History', category: 'Books', price: 19.99, description: 'Human history exploration', boxSize: '20x13x4', boxQuantity: 1 },
                { id: 64, name: 'The 7 Habits of Highly Effective People', category: 'Books', price: 17.99, description: 'Personal development classic', boxSize: '20x13x3', boxQuantity: 1 },
                { id: 65, name: 'Think and Grow Rich', category: 'Books', price: 15.99, description: 'Success philosophy book', boxSize: '20x13x3', boxQuantity: 1 },
                { id: 66, name: 'The Lean Startup', category: 'Books', price: 21.99, description: 'Entrepreneurship methodology', boxSize: '20x13x3', boxQuantity: 1 },
                { id: 67, name: 'Good to Great', category: 'Books', price: 19.99, description: 'Business transformation guide', boxSize: '20x13x4', boxQuantity: 1 },
                { id: 68, name: 'The Power of Now', category: 'Books', price: 16.99, description: 'Spiritual awakening guide', boxSize: '20x13x3', boxQuantity: 1 },
                { id: 69, name: 'Rich Dad Poor Dad', category: 'Books', price: 17.99, description: 'Financial education book', boxSize: '20x13x3', boxQuantity: 1 },
                { id: 70, name: 'The 4-Hour Workweek', category: 'Books', price: 18.99, description: 'Lifestyle design book', boxSize: '20x13x3', boxQuantity: 1 },

                // Automotive (10 products)
                { id: 71, name: 'Michelin Pilot Sport Tires', category: 'Automotive', price: 299.99, description: 'High-performance tires', boxSize: '70x70x25', boxQuantity: 4 },
                { id: 72, name: 'Bosch Car Battery', category: 'Automotive', price: 149.99, description: 'Maintenance-free car battery', boxSize: '35x20x25', boxQuantity: 1 },
                { id: 73, name: 'Garmin DriveSmart GPS', category: 'Automotive', price: 199.99, description: '7-inch GPS navigator', boxSize: '25x20x8', boxQuantity: 1 },
                { id: 74, name: 'WeatherTech Floor Mats', category: 'Automotive', price: 179.99, description: 'Custom-fit floor protection', boxSize: '80x50x5', boxQuantity: 1 },
                { id: 75, name: 'Thule Roof Cargo Box', category: 'Automotive', price: 599.99, description: 'Aerodynamic cargo carrier', boxSize: '200x80x40', boxQuantity: 1 },
                { id: 76, name: 'Mobil 1 Synthetic Oil', category: 'Automotive', price: 49.99, description: '5-quart synthetic motor oil', boxSize: '30x20x25', boxQuantity: 1 },
                { id: 77, name: 'Pioneer Car Stereo System', category: 'Automotive', price: 299.99, description: 'Touchscreen car stereo', boxSize: '25x20x15', boxQuantity: 1 },
                { id: 78, name: 'Armor All Car Care Kit', category: 'Automotive', price: 39.99, description: 'Complete car cleaning kit', boxSize: '40x30x20', boxQuantity: 1 },
                { id: 79, name: 'Yakima Bike Rack', category: 'Automotive', price: 449.99, description: 'Hitch-mounted bike carrier', boxSize: '120x30x20', boxQuantity: 1 },
                { id: 80, name: 'Anker Car Charger', category: 'Automotive', price: 24.99, description: 'Fast-charging car adapter', boxSize: '15x10x5', boxQuantity: 1 },

                // Health & Beauty (10 products)
                { id: 81, name: 'Olay Regenerist Serum', category: 'Health & Beauty', price: 28.99, description: 'Anti-aging facial serum', boxSize: '15x8x5', boxQuantity: 1 },
                { id: 82, name: 'Philips Sonicare Toothbrush', category: 'Health & Beauty', price: 199.99, description: 'Electric toothbrush with app', boxSize: '25x15x8', boxQuantity: 1 },
                { id: 83, name: 'Neutrogena Sunscreen SPF 50', category: 'Health & Beauty', price: 12.99, description: 'Broad spectrum sunscreen', boxSize: '15x8x5', boxQuantity: 1 },
                { id: 84, name: 'L\'Oreal Hair Color Kit', category: 'Health & Beauty', price: 19.99, description: 'At-home hair coloring', boxSize: '20x15x8', boxQuantity: 1 },
                { id: 85, name: 'Cetaphil Gentle Cleanser', category: 'Health & Beauty', price: 14.99, description: 'Sensitive skin face wash', boxSize: '20x10x8', boxQuantity: 1 },
                { id: 86, name: 'Braun Electric Shaver', category: 'Health & Beauty', price: 299.99, description: 'Wet & dry electric shaver', boxSize: '30x20x15', boxQuantity: 1 },
                { id: 87, name: 'Revlon Hair Dryer', category: 'Health & Beauty', price: 59.99, description: 'Ionic hair dryer with diffuser', boxSize: '35x25x15', boxQuantity: 1 },
                { id: 88, name: 'CeraVe Moisturizing Cream', category: 'Health & Beauty', price: 16.99, description: 'Daily facial moisturizer', boxSize: '15x10x8', boxQuantity: 1 },
                { id: 89, name: 'Maybelline Makeup Set', category: 'Health & Beauty', price: 49.99, description: 'Complete makeup collection', boxSize: '30x20x10', boxQuantity: 1 },
                { id: 90, name: 'Dove Body Wash 3-Pack', category: 'Health & Beauty', price: 18.99, description: 'Moisturizing body wash', boxSize: '25x15x20', boxQuantity: 1 },

                // Food & Beverages (5 products)
                { id: 91, name: 'Starbucks Coffee Beans 2lb', category: 'Food & Beverages', price: 24.99, description: 'Premium whole bean coffee', boxSize: '20x15x10', boxQuantity: 1 },
                { id: 92, name: 'Ghirardelli Chocolate Gift Box', category: 'Food & Beverages', price: 39.99, description: 'Assorted premium chocolates', boxSize: '30x20x8', boxQuantity: 1 },
                { id: 93, name: 'Organic Honey 32oz', category: 'Food & Beverages', price: 19.99, description: 'Raw unfiltered honey', boxSize: '15x10x15', boxQuantity: 1 },
                { id: 94, name: 'Gourmet Tea Sampler', category: 'Food & Beverages', price: 34.99, description: '20 premium tea varieties', boxSize: '25x20x8', boxQuantity: 1 },
                { id: 95, name: 'Artisan Pasta Gift Set', category: 'Food & Beverages', price: 29.99, description: 'Italian pasta with sauces', boxSize: '35x25x10', boxQuantity: 1 },

                // Office Supplies (5 products)
                { id: 96, name: 'Herman Miller Office Chair', category: 'Office Supplies', price: 1395.00, description: 'Ergonomic office chair', boxSize: '80x70x120', boxQuantity: 1 },
                { id: 97, name: 'Standing Desk Converter', category: 'Office Supplies', price: 299.99, description: 'Adjustable desk riser', boxSize: '80x60x15', boxQuantity: 1 },
                { id: 98, name: 'HP LaserJet Printer', category: 'Office Supplies', price: 199.99, description: 'Wireless laser printer', boxSize: '45x35x25', boxQuantity: 1 },
                { id: 99, name: 'Staples Office Supply Bundle', category: 'Office Supplies', price: 79.99, description: 'Complete office essentials', boxSize: '40x30x20', boxQuantity: 1 },
                { id: 100, name: 'Logitech Wireless Mouse & Keyboard', category: 'Office Supplies', price: 89.99, description: 'Ergonomic wireless combo', boxSize: '45x20x8', boxQuantity: 1 },

                // Toys & Games (5 products)
                { id: 101, name: 'LEGO Creator Expert Set', category: 'Toys & Games', price: 199.99, description: 'Advanced building set 18+', boxSize: '50x35x15', boxQuantity: 1 },
                { id: 102, name: 'PlayStation 5 Console', category: 'Toys & Games', price: 499.99, description: 'Next-gen gaming console', boxSize: '40x30x15', boxQuantity: 1 },
                { id: 103, name: 'Monopoly Board Game', category: 'Toys & Games', price: 19.99, description: 'Classic family board game', boxSize: '40x27x5', boxQuantity: 1 },
                { id: 104, name: 'Nerf Elite Blaster', category: 'Toys & Games', price: 49.99, description: 'Foam dart blaster toy', boxSize: '60x30x10', boxQuantity: 1 },
                { id: 105, name: 'Rubik\'s Cube 3x3', category: 'Toys & Games', price: 14.99, description: 'Original puzzle cube', boxSize: '12x8x8', boxQuantity: 1 }
            ];
            
            filteredLibrary = [...productLibrary];
        }

        // Save and load app title
        function saveAppTitle() {
            appTitle = document.getElementById('appTitle').value || 'QuoteFlow';
            saveData();
        }

        // Multiple photos handling
        function handleMultiplePhotosUpload(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;

            files.forEach(file => {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert(`Photo "${file.name}" is too large. Maximum size is 5MB.`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoData = {
                        id: Date.now() + Math.random(),
                        name: file.name,
                        data: e.target.result
                    };
                    currentPhotos.push(photoData);
                    renderPhotoGallery();
                    
                    // Detect colors from the first uploaded image
                    if (currentPhotos.length === 1) {
                        detectColorsFromImage(photoData.data);
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function renderPhotoGallery() {
            const gallery = document.getElementById('photoGallery');
            const grid = document.getElementById('photoGrid');
            
            if (currentPhotos.length === 0) {
                gallery.classList.add('hidden');
                return;
            }
            
            gallery.classList.remove('hidden');
            grid.innerHTML = currentPhotos.map(photo => `
                <div class="photo-item">
                    <img src="${photo.data}" alt="${photo.name}" title="${photo.name}">
                    <button class="photo-remove" onclick="removePhoto('${photo.id}')" title="Remove photo">×</button>
                </div>
            `).join('');
        }

        function removePhoto(photoId) {
            currentPhotos = currentPhotos.filter(photo => photo.id !== photoId);
            renderPhotoGallery();
        }

        function clearAllPhotos() {
            currentPhotos = [];
            document.getElementById('productPhotos').value = '';
            renderPhotoGallery();
        }

        function addProduct() {
            const name = document.getElementById('productName').value.trim();
            let serialNumber = document.getElementById('serialNumber').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const unitPrice = parseFloat(document.getElementById('unitPrice').value) || 0;
            const weight = parseFloat(document.getElementById('weight').value) || 0;
            const weightUnit = document.getElementById('weightUnit').value;
            const category = document.getElementById('productCategory').value;
            const boxSize = document.getElementById('boxSize').value.trim();
            const boxQuantity = parseInt(document.getElementById('boxQuantity').value) || 1;
            const description = document.getElementById('description').value.trim();
            const color = document.getElementById('productColor').value;
            const productCalculationMethod = document.getElementById('productCalculationMethod').value;

            if (!name || unitPrice <= 0) {
                alert('Please enter a valid product name and unit price.');
                return;
            }

            if (editingProductId) {
                // Update existing product
                const productIndex = products.findIndex(p => p.id === editingProductId);
                if (productIndex !== -1) {
                    // Keep existing serial number if not changed
                    if (!serialNumber) {
                        serialNumber = products[productIndex].serialNumber;
                    }
                    
                    products[productIndex] = {
                        ...products[productIndex],
                        name,
                        serialNumber,
                        quantity,
                        unitPrice,
                        weight,
                        weightUnit,
                        category,
                        boxSize,
                        boxQuantity,
                        description,
                        color,
                        photos: [...currentPhotos],
                        calculationMethod: productCalculationMethod,
                        total: quantity * unitPrice
                    };
                    
                    showEditNotification('updated');
                    editingProductId = null;
                    document.querySelector('button[onclick="addProduct()"]').textContent = 'Add to Quote';
                    document.querySelector('button[onclick="addProduct()"]').className = 'w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105';
                    document.getElementById('cancelEditBtn').classList.add('hidden');
                }
            } else {
                // Add new product
                // Auto-generate serial number if not provided
                if (!serialNumber) {
                    serialNumber = generateAutoSerialNumber();
                }

                const product = {
                    id: Date.now(),
                    name,
                    serialNumber,
                    quantity,
                    unitPrice,
                    weight,
                    weightUnit,
                    category,
                    boxSize,
                    boxQuantity,
                    description,
                    color,
                    photos: [...currentPhotos],
                    calculationMethod: productCalculationMethod,
                    total: quantity * unitPrice
                };

                products.push(product);
            }

            renderProducts();
            updateTotals();
            updateRealTimeStats();
            clearForm();
            saveData();
        }

        function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            // Fill form with product data
            document.getElementById('productName').value = product.name;
            document.getElementById('serialNumber').value = product.serialNumber;
            document.getElementById('quantity').value = product.quantity;
            document.getElementById('unitPrice').value = product.unitPrice;
            document.getElementById('weight').value = product.weight || '';
            document.getElementById('weightUnit').value = product.weightUnit || 'kg';
            document.getElementById('description').value = product.description;
            document.getElementById('productColor').value = product.color || '#3B82F6';
            document.getElementById('productCategory').value = product.category || '';
            document.getElementById('boxSize').value = product.boxSize || '';
            document.getElementById('boxQuantity').value = product.boxQuantity || 1;
            document.getElementById('productCalculationMethod').value = product.calculationMethod || '';
            
            // Handle photos
            if (product.photos && product.photos.length > 0) {
                currentPhotos = [...product.photos];
                renderPhotoGallery();
            }

            // Set editing mode
            editingProductId = id;
            const button = document.querySelector('button[onclick="addProduct()"]');
            button.textContent = 'Update Product';
            button.className = 'w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 transform hover:scale-105';
            
            // Show cancel button
            document.getElementById('cancelEditBtn').classList.remove('hidden');
            
            // Scroll to form
            document.querySelector('.glass-effect').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            editingProductId = null;
            clearForm();
            const button = document.querySelector('button[onclick="addProduct()"]');
            button.textContent = 'Add to Quote';
            button.className = 'w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105';
            
            // Hide cancel button
            document.getElementById('cancelEditBtn').classList.add('hidden');
        }

        function showEditNotification(action) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = `Product ${action} successfully!`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function removeProduct(id) {
            // Convert id to number to ensure proper comparison
            const productId = parseInt(id);
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                console.error('Product not found:', productId);
                return;
            }
            
            if (confirm(`Are you sure you want to delete "${product.name}"?`)) {
                // If we're editing this product, cancel edit mode
                if (editingProductId === productId) {
                    cancelEdit();
                }
                
                // Remove the product from the array
                products = products.filter(p => p.id !== productId);
                
                // Re-render the products list
                renderProducts();
                updateTotals();
                updateRealTimeStats();
                saveData();
                showDeleteNotification(product.name);
            }
        }

        function showDeleteNotification(productName) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = `"${productName}" deleted successfully`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function renderProducts() {
            const productsList = document.getElementById('productsList');
            const totalsSection = document.getElementById('totalsSection');
            const actionButtons = document.getElementById('actionButtons');

            if (products.length === 0) {
                productsList.innerHTML = `
                    <div class="text-center py-12 text-white/60">
                        <div class="text-6xl mb-4">📋</div>
                        <p class="text-lg">No products added yet</p>
                        <p class="text-sm">Add your first product to get started</p>
                    </div>
                `;
                totalsSection.classList.add('hidden');
                actionButtons.classList.add('hidden');
                return;
            }

            productsList.innerHTML = products.map(product => `
                <div class="product-card glass-effect rounded-lg p-4 animate-slide-in border border-white/20 backdrop-blur-sm">
                    <div class="flex justify-between items-start gap-4">
                        ${product.photos && product.photos.length > 0 ? `
                            <div class="flex-shrink-0">
                                <div class="relative">
                                    <img src="${product.photos[0].data}" alt="${product.name}" 
                                         class="w-16 h-16 object-cover rounded-lg border border-white/30">
                                    ${product.photos.length > 1 ? `
                                        <div class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                            ${product.photos.length}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <h4 class="font-semibold text-white text-lg">${product.name}</h4>
                                ${product.color ? `<div class="w-4 h-4 rounded-full border border-white/30" style="background-color: ${product.color}" title="Color: ${product.color}"></div>` : ''}
                            </div>
                            ${product.serialNumber ? `<p class="text-blue-300 text-sm font-medium">SN: ${product.serialNumber}</p>` : ''}
                            ${product.description ? `<p class="text-white/80 text-sm mt-1">${product.description}</p>` : ''}
                            <div class="grid grid-cols-2 gap-2 mt-2 text-sm text-white/70">
                                <span>Qty: ${product.quantity}</span>
                                <span>Unit: ${formatCurrency(product.unitPrice)}</span>
                                ${product.weight ? `<span>⚖️ ${product.weight}${product.weightUnit || 'kg'}</span>` : '<span></span>'}
                                ${product.category ? `<span>📂 ${product.category}</span>` : '<span></span>'}
                                ${product.boxSize ? `<span>📦 ${product.boxSize}cm</span>` : '<span></span>'}
                                ${product.boxQuantity ? `<span>📦 x${product.boxQuantity}</span>` : '<span></span>'}
                                ${product.calculationMethod ? `<span>🧮 ${getCalculationMethodName(product.calculationMethod)}</span>` : '<span></span>'}
                                ${product.color ? `<span class="flex items-center gap-1"><div class="w-3 h-3 rounded-full" style="background-color: ${product.color}"></div>${getColorName(product.color)}</span>` : '<span></span>'}
                                ${product.photos && product.photos.length > 0 ? `<span>📷 ${product.photos.length}</span>` : '<span></span>'}
                            </div>
                        </div>
                        <div class="text-right ml-4">
                            <div class="text-xl font-bold text-white">${formatCurrency(product.total)}</div>
                            <div class="flex gap-1 mt-1 flex-wrap">
                                <button onclick="showProductDetails(${product.id})" 
                                        class="bg-white/20 hover:bg-white/30 text-white text-xs px-2 py-1 rounded-full transition-colors flex items-center gap-1 backdrop-blur-sm border border-white/30">
                                    📋 Details
                                </button>
                                <button onclick="editProduct(${product.id})" 
                                        class="bg-blue-500/80 hover:bg-blue-600 text-white text-xs px-2 py-1 rounded-full transition-colors flex items-center gap-1 backdrop-blur-sm">
                                    ✏️ Edit
                                </button>
                                <button onclick="removeProduct(${product.id})" 
                                        class="bg-red-500/80 hover:bg-red-600 text-white text-xs px-2 py-1 rounded-full transition-colors flex items-center gap-1 backdrop-blur-sm">
                                    🗑️ Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            totalsSection.classList.remove('hidden');
            actionButtons.classList.remove('hidden');
        }

        function updateTotals() {
            if (products.length === 0) return;

            const originalSubtotal = products.reduce((sum, product) => sum + product.total, 0);
            const discountRate = parseFloat(document.getElementById('discount').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const calculationMethod = document.getElementById('calculationMethod').value;

            let subtotal = originalSubtotal;
            let discountAmount = 0;
            let taxAmount = 0;
            let total = 0;

            // Apply calculation method
            switch (calculationMethod) {
                case 'standard':
                    // Standard: Subtotal + Tax
                    taxAmount = subtotal * (taxRate / 100);
                    total = subtotal + taxAmount;
                    break;
                    
                case 'discount':
                    // With Discount: Subtotal - Discount + Tax
                    discountAmount = subtotal * (discountRate / 100);
                    subtotal = originalSubtotal - discountAmount;
                    taxAmount = subtotal * (taxRate / 100);
                    total = subtotal + taxAmount;
                    break;
                    
                case 'markup':
                    // Cost + Markup: Apply 20% markup to each product
                    subtotal = products.reduce((sum, product) => {
                        const markup = product.unitPrice * 0.2; // 20% markup
                        return sum + ((product.unitPrice + markup) * product.quantity);
                    }, 0);
                    taxAmount = subtotal * (taxRate / 100);
                    total = subtotal + taxAmount;
                    break;
                    
                case 'tiered':
                    // Tiered Pricing: Discount based on order value
                    if (originalSubtotal > 1000) {
                        subtotal = originalSubtotal * 0.9; // 10% discount for orders over $1000
                    } else if (originalSubtotal > 500) {
                        subtotal = originalSubtotal * 0.95; // 5% discount for orders over $500
                    }
                    taxAmount = subtotal * (taxRate / 100);
                    total = subtotal + taxAmount;
                    break;
                    
                case 'bulk':
                    // Bulk Discount: Discount based on total quantity
                    const totalQuantity = products.reduce((sum, product) => sum + product.quantity, 0);
                    if (totalQuantity > 50) {
                        subtotal = originalSubtotal * 0.85; // 15% discount for 50+ items
                    } else if (totalQuantity > 20) {
                        subtotal = originalSubtotal * 0.9; // 10% discount for 20+ items
                    } else if (totalQuantity > 10) {
                        subtotal = originalSubtotal * 0.95; // 5% discount for 10+ items
                    }
                    taxAmount = subtotal * (taxRate / 100);
                    total = subtotal + taxAmount;
                    break;
                    
                case 'custom':
                    // Custom Formula: (Subtotal * 1.1) - discount + tax
                    subtotal = originalSubtotal * 1.1; // 10% markup
                    discountAmount = subtotal * (discountRate / 100);
                    subtotal = subtotal - discountAmount;
                    taxAmount = subtotal * (taxRate / 100);
                    total = subtotal + taxAmount;
                    break;
                    
                default:
                    // Default to discount method
                    discountAmount = subtotal * (discountRate / 100);
                    subtotal = originalSubtotal - discountAmount;
                    taxAmount = subtotal * (taxRate / 100);
                    total = subtotal + taxAmount;
            }

            // Update display
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('discountAmount').textContent = `-${formatCurrency(discountAmount)}`;
            document.getElementById('taxAmount').textContent = formatCurrency(taxAmount);
            document.getElementById('total').textContent = formatCurrency(total);
            
            // Show calculation method info
            updateCalculationMethodDisplay(calculationMethod, originalSubtotal, subtotal);
        }

        function updateCalculationMethod() {
            const method = document.getElementById('calculationMethod').value;
            showCalculationMethodNotification(getCalculationMethodName(method));
        }

        function getCalculationMethodName(method) {
            const names = {
                'standard': '📊 Standard (Subtotal + Tax)',
                'discount': '💰 With Discount',
                'markup': '📈 Cost + Markup (20%)',
                'tiered': '🎯 Tiered Pricing',
                'bulk': '📦 Bulk Discount',
                'custom': '⚙️ Custom Formula'
            };
            return names[method] || 'Standard';
        }

        function updateCalculationMethodDisplay(method, originalSubtotal, finalSubtotal) {
            // Add visual indicator for calculation method changes
            if (method !== 'standard' && originalSubtotal !== finalSubtotal) {
                const indicator = document.createElement('div');
                indicator.className = 'text-xs text-blue-300 mt-1';
                indicator.textContent = `Applied: ${getCalculationMethodName(method)}`;
                
                // Remove existing indicators
                const existing = document.querySelector('.calculation-indicator');
                if (existing) existing.remove();
                
                indicator.className += ' calculation-indicator';
                document.getElementById('total').parentNode.appendChild(indicator);
            }
        }

        function showCalculationMethodNotification(methodName) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = `Calculation method changed to: ${methodName}`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function clearForm() {
            document.getElementById('productName').value = '';
            document.getElementById('serialNumber').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('unitPrice').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('weightUnit').value = 'kg';
            document.getElementById('productCategory').value = '';
            document.getElementById('boxSize').value = '';
            document.getElementById('boxQuantity').value = '';
            document.getElementById('description').value = '';
            document.getElementById('productColor').value = '#3B82F6';
            document.getElementById('colorPreset').value = '';
            document.getElementById('productCalculationMethod').value = '';
            document.getElementById('productPhotos').value = '';
            currentPhotos = [];
            renderPhotoGallery();
        }

        // Product Library Functions
        function showProductLibrary() {
            const modal = document.getElementById('productLibraryModal');
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
            renderProductLibrary();
        }

        function closeProductLibraryModal() {
            const modal = document.getElementById('productLibraryModal');
            modal.style.display = 'none';
            modal.classList.add('hidden');
        }

        function renderProductLibrary() {
            const grid = document.getElementById('productLibraryGrid');
            grid.innerHTML = filteredLibrary.map(product => `
                <div class="database-card rounded-xl p-4 product-library-item" data-category="${product.category}">
                    <div class="flex flex-col h-full">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h4 class="font-semibold text-white text-lg">${product.name}</h4>
                                <span class="text-xs bg-white/20 text-white px-2 py-1 rounded-full">${product.category}</span>
                            </div>
                            <p class="text-white/80 text-sm mb-3">${product.description}</p>
                            <div class="space-y-2 text-sm text-white/70">
                                <div class="flex justify-between">
                                    <span>Price:</span>
                                    <span class="font-semibold text-green-300">${formatCurrency(product.price)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Box Size:</span>
                                    <span>${product.boxSize} cm</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Box Qty:</span>
                                    <span>${product.boxQuantity}</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="addFromLibrary(${product.id})" 
                                class="mt-4 w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 text-sm">
                            ➕ Add to Quote
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addFromLibrary(productId) {
            const libraryProduct = productLibrary.find(p => p.id === productId);
            if (!libraryProduct) return;

            // Auto-generate serial number
            const serialNumber = generateAutoSerialNumber();

            const product = {
                id: Date.now(),
                name: libraryProduct.name,
                serialNumber: serialNumber,
                quantity: 1,
                unitPrice: libraryProduct.price,
                weight: 0,
                weightUnit: 'kg',
                category: libraryProduct.category,
                boxSize: libraryProduct.boxSize,
                boxQuantity: libraryProduct.boxQuantity,
                description: libraryProduct.description,
                color: '#3B82F6',
                photos: [],
                total: libraryProduct.price
            };

            products.push(product);
            renderProducts();
            updateTotals();
            updateRealTimeStats();
            saveData();
            closeProductLibraryModal();
            
            showLibraryNotification(`"${libraryProduct.name}" added to quote!`);
        }

        function filterLibraryProducts(query) {
            const searchTerm = query.toLowerCase().trim();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            filteredLibrary = productLibrary.filter(product => {
                const matchesSearch = !searchTerm || 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm);
                
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
            
            renderProductLibrary();
        }

        function filterByCategory(category) {
            const searchInput = document.getElementById('librarySearchInput');
            filterLibraryProducts(searchInput.value);
        }

        function showLibraryNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Share Functions
        function shareQuote() {
            if (products.length === 0) {
                alert('Please add at least one product before sharing the quote.');
                return;
            }
            
            const modal = document.getElementById('shareModal');
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
            
            // Generate share link (simplified for demo)
            const shareData = {
                quoteNumber: document.getElementById('quoteNumber').textContent,
                products: products,
                total: products.reduce((sum, product) => sum + product.total, 0),
                date: document.getElementById('quoteDate').textContent
            };
            
            const shareLink = `${window.location.origin}${window.location.pathname}?quote=${btoa(JSON.stringify(shareData))}`;
            document.getElementById('shareLink').value = shareLink;
        }

        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            modal.style.display = 'none';
            modal.classList.add('hidden');
        }

        function copyShareLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            shareLink.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showShareNotification('Link copied to clipboard!');
            } catch (err) {
                showShareNotification('Failed to copy link');
            }
        }

        function shareViaEmail() {
            const shareLink = document.getElementById('shareLink').value;
            const subject = `Quote ${document.getElementById('quoteNumber').textContent} - ${appTitle}`;
            const body = `Hi,\n\nPlease find the quote details at the following link:\n\n${shareLink}\n\nBest regards`;
            
            window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
        }

        function shareViaWhatsApp() {
            const shareLink = document.getElementById('shareLink').value;
            const message = `Quote ${document.getElementById('quoteNumber').textContent} - ${appTitle}\n\n${shareLink}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`);
        }

        function generateQRCode() {
            const shareLink = document.getElementById('shareLink').value;
            const qrContainer = document.getElementById('qrCodeContainer');
            const qrCode = document.getElementById('qrCode');
            
            // Simple QR code generation (using a service for demo)
            qrCode.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(shareLink)}" alt="QR Code" class="mx-auto">`;
            qrContainer.classList.remove('hidden');
        }

        function showShareNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function clearQuote() {
            if (products.length === 0) {
                alert('No products to clear!');
                return;
            }
            
            if (confirm('Are you sure you want to clear all products from this quote?')) {
                // Clear the products array
                products = [];
                
                // Reset editing state if active
                if (editingProductId) {
                    cancelEdit();
                }
                
                // Re-render everything
                renderProducts();
                updateTotals();
                updateRealTimeStats();
                
                // Generate new quote number and reset serial counter
                quoteCounter++;
                serialCounter = 1;
                document.getElementById('quoteNumber').textContent = `QF-2024-${String(quoteCounter).padStart(3, '0')}`;
                
                // Clear form fields
                clearForm();
                
                // Save the changes
                saveData();
                showClearNotification();
            }
        }

        function showClearNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-orange-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.innerHTML = '🗑️ Quote cleared successfully!';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function printQuote() {
            if (products.length === 0) {
                alert('Please add at least one product before printing the quote.');
                return;
            }

            // Create a new window for printing
            const printWindow = window.open('', '_blank');
            
            // Calculate totals for print
            const subtotal = products.reduce((sum, product) => sum + product.total, 0);
            const discountRate = parseFloat(document.getElementById('discount').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const calculationMethod = document.getElementById('calculationMethod').value;
            
            let finalSubtotal = subtotal;
            let discountAmount = 0;
            let taxAmount = 0;
            let total = 0;
            
            // Apply calculation method
            switch (calculationMethod) {
                case 'standard':
                    taxAmount = finalSubtotal * (taxRate / 100);
                    total = finalSubtotal + taxAmount;
                    break;
                case 'discount':
                    discountAmount = finalSubtotal * (discountRate / 100);
                    finalSubtotal = subtotal - discountAmount;
                    taxAmount = finalSubtotal * (taxRate / 100);
                    total = finalSubtotal + taxAmount;
                    break;
                case 'markup':
                    // Apply markup to each product
                    finalSubtotal = products.reduce((sum, product) => {
                        const markup = product.unitPrice * 0.2; // 20% markup
                        return sum + ((product.unitPrice + markup) * product.quantity);
                    }, 0);
                    taxAmount = finalSubtotal * (taxRate / 100);
                    total = finalSubtotal + taxAmount;
                    break;
                case 'tiered':
                    // Apply tiered pricing
                    if (subtotal > 1000) finalSubtotal = subtotal * 0.9; // 10% discount for orders over $1000
                    else if (subtotal > 500) finalSubtotal = subtotal * 0.95; // 5% discount for orders over $500
                    taxAmount = finalSubtotal * (taxRate / 100);
                    total = finalSubtotal + taxAmount;
                    break;
                case 'bulk':
                    // Apply bulk discount based on total quantity
                    const totalQuantity = products.reduce((sum, product) => sum + product.quantity, 0);
                    if (totalQuantity > 50) finalSubtotal = subtotal * 0.85; // 15% discount for 50+ items
                    else if (totalQuantity > 20) finalSubtotal = subtotal * 0.9; // 10% discount for 20+ items
                    else if (totalQuantity > 10) finalSubtotal = subtotal * 0.95; // 5% discount for 10+ items
                    taxAmount = finalSubtotal * (taxRate / 100);
                    total = finalSubtotal + taxAmount;
                    break;
                case 'custom':
                    // Custom formula: (Subtotal * 1.1) - discount + tax
                    finalSubtotal = subtotal * 1.1; // 10% markup
                    discountAmount = finalSubtotal * (discountRate / 100);
                    finalSubtotal = finalSubtotal - discountAmount;
                    taxAmount = finalSubtotal * (taxRate / 100);
                    total = finalSubtotal + taxAmount;
                    break;
                default:
                    discountAmount = finalSubtotal * (discountRate / 100);
                    finalSubtotal = subtotal - discountAmount;
                    taxAmount = finalSubtotal * (taxRate / 100);
                    total = finalSubtotal + taxAmount;
            }

            const printContent = `<!DOCTYPE html>
<html>
<head>
    <title>Quotation - ${document.getElementById('quoteNumber').textContent}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: white;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 20px; 
            border: 2px solid #333; 
            border-radius: 10px;
        }
        .header h1 { font-size: 2rem; margin-bottom: 10px; }
        .quote-info { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .quote-info div { padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .products { margin-bottom: 30px; }
        .products h2 { margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .product { 
            border: 1px solid #ddd; 
            margin-bottom: 15px; 
            padding: 15px; 
            border-radius: 5px;
        }
        .product-header { font-weight: bold; margin-bottom: 10px; }
        .product-details { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .totals { 
            border: 2px solid #333; 
            padding: 20px; 
            border-radius: 10px; 
            background: #f9f9f9;
        }
        .total-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 5px 0; 
            border-bottom: 1px solid #ddd; 
        }
        .total-row.final { 
            font-weight: bold; 
            font-size: 1.2rem; 
            border-bottom: 2px solid #333; 
            margin-top: 10px; 
            padding-top: 10px; 
        }
        .calculation-method {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }
        @media print {
            body { padding: 0; }
            .container { max-width: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💼 QUOTATION</h1>
            <p>Quote #${document.getElementById('quoteNumber').textContent} | ${appTitle}</p>
        </div>
        
        <div class="quote-info">
            <div>
                <h3>Quote Information</h3>
                <p><strong>Date:</strong> ${document.getElementById('quoteDate').textContent}</p>
                <p><strong>Valid Until:</strong> ${document.getElementById('validDate').textContent}</p>
                <p><strong>Currency:</strong> ${currentCurrency}</p>
            </div>
            <div>
                <h3>Summary</h3>
                <p><strong>Total Products:</strong> ${products.length}</p>
                <p><strong>Total Weight:</strong> ${products.reduce((sum, p) => sum + (parseFloat(p.weight) || 0), 0).toFixed(1)}kg</p>
                <p><strong>Total Amount:</strong> ${formatCurrency(total)}</p>
            </div>
        </div>
        
        <div class="calculation-method">
            <strong>Calculation Method:</strong> ${getCalculationMethodName(calculationMethod)}
        </div>
        
        <div class="products">
            <h2>Product Details</h2>
            ${products.map((product, index) => `
                <div class="product">
                    <div class="product-header">${index + 1}. ${product.name}</div>
                    ${product.serialNumber ? `<p><strong>Serial:</strong> ${product.serialNumber}</p>` : ''}
                    <div class="product-details">
                        <div><strong>Quantity:</strong> ${product.quantity}</div>
                        <div><strong>Unit Price:</strong> ${formatCurrency(product.unitPrice)}</div>
                        <div><strong>Weight:</strong> ${product.weight ? product.weight + (product.weightUnit || 'kg') : 'N/A'}</div>
                        <div><strong>Total:</strong> ${formatCurrency(product.total)}</div>
                    </div>
                    ${product.description ? `<p style="margin-top: 10px;"><strong>Description:</strong> ${product.description}</p>` : ''}
                </div>
            `).join('')}
        </div>
        
        <div class="totals">
            <h2>Financial Summary</h2>
            <div class="total-row">
                <span>Original Subtotal:</span>
                <span>${formatCurrency(subtotal)}</span>
            </div>
            ${calculationMethod !== 'standard' && finalSubtotal !== subtotal ? `
                <div class="total-row">
                    <span>Adjusted Subtotal:</span>
                    <span>${formatCurrency(finalSubtotal)}</span>
                </div>
            ` : ''}
            ${discountAmount > 0 ? `
                <div class="total-row">
                    <span>Discount (${discountRate}%):</span>
                    <span>-${formatCurrency(discountAmount)}</span>
                </div>
            ` : ''}
            <div class="total-row">
                <span>Tax (${taxRate}%):</span>
                <span>${formatCurrency(taxAmount)}</span>
            </div>
            <div class="total-row final">
                <span>TOTAL AMOUNT:</span>
                <span>${formatCurrency(total)}</span>
            </div>
        </div>
        
        <div style="margin-top: 30px; text-align: center; color: #666;">
            <p>Thank you for your business!</p>
            <p>Generated on ${new Date().toLocaleString()}</p>
        </div>
    </div>
</body>
</html>`;

            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Wait for content to load then print
            printWindow.onload = function() {
                printWindow.print();
                printWindow.close();
            };

            showPrintNotification();
        }

        function showPrintNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.innerHTML = '🖨️ Print dialog opened!';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function downloadQuote() {
            if (products.length === 0) {
                alert('Please add at least one product before downloading the quote.');
                return;
            }

            // Show download options modal
            showDownloadModal();
        }

        function showDownloadModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-6 rounded-t-2xl">
                        <h3 class="text-xl font-bold flex items-center gap-2">
                            📄 Download Options
                        </h3>
                        <p class="text-white/80 text-sm">Choose your preferred format</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <button onclick="downloadAsHTML(); this.closest('.fixed').remove();" 
                                class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex items-center justify-center gap-2">
                            🌐 Professional HTML Form
                        </button>
                        <button onclick="downloadAsText(); this.closest('.fixed').remove();" 
                                class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 flex items-center justify-center gap-2">
                            📝 Simple Text Format
                        </button>
                        <button onclick="downloadAsCSV(); this.closest('.fixed').remove();" 
                                class="w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex items-center justify-center gap-2">
                            📊 Excel/CSV Format
                        </button>
                        <button onclick="this.closest('.fixed').remove();" 
                                class="w-full bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function downloadAsHTML() {
            // Calculate totals
            const subtotal = products.reduce((sum, product) => sum + product.total, 0);
            const discountRate = parseFloat(document.getElementById('discount').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discountAmount = subtotal * (discountRate / 100);
            const afterDiscount = subtotal - discountAmount;
            const taxAmount = afterDiscount * (taxRate / 100);
            const total = afterDiscount + taxAmount;

            const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotation - ${document.getElementById('quoteNumber').textContent}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: #f8fafc;
            padding: 20px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 40px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .quote-info { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            padding: 30px 40px; 
            background: #f8fafc; 
            border-bottom: 2px solid #e2e8f0;
        }
        .quote-info div { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .quote-info h3 { color: #4a5568; margin-bottom: 10px; font-weight: 600; }
        .quote-info p { color: #2d3748; font-weight: 500; }
        .products { padding: 40px; }
        .products h2 { 
            color: #2d3748; 
            margin-bottom: 30px; 
            font-size: 1.8rem; 
            border-bottom: 3px solid #667eea; 
            padding-bottom: 10px; 
        }
        .product { 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .product-header { 
            background: #f7fafc; 
            padding: 20px; 
            border-bottom: 1px solid #e2e8f0; 
        }
        .product-header h3 { color: #2d3748; font-size: 1.3rem; margin-bottom: 5px; }
        .product-header .serial { color: #4299e1; font-weight: 500; font-size: 0.9rem; }
        .product-body { padding: 20px; }
        .product-details { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 15px; 
            margin-bottom: 15px; 
        }
        .detail-item { text-align: center; }
        .detail-label { color: #718096; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .detail-value { color: #2d3748; font-weight: 600; font-size: 1.1rem; margin-top: 5px; }
        .color-display { 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
            background: #f7fafc; 
            padding: 5px 12px; 
            border-radius: 20px; 
            border: 1px solid #e2e8f0;
        }
        .color-dot { width: 16px; height: 16px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 0 1px #e2e8f0; }
        .description { 
            background: #f7fafc; 
            padding: 15px; 
            border-radius: 6px; 
            color: #4a5568; 
            font-style: italic; 
            margin-top: 15px;
        }
        .totals { 
            background: #f7fafc; 
            padding: 40px; 
            border-top: 2px solid #e2e8f0; 
        }
        .totals h2 { 
            color: #2d3748; 
            margin-bottom: 25px; 
            font-size: 1.8rem; 
            text-align: center; 
        }
        .totals-grid { 
            max-width: 400px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 8px; 
            padding: 25px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .total-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-bottom: 1px solid #e2e8f0; 
        }
        .total-row:last-child { 
            border-bottom: 2px solid #667eea; 
            font-weight: 700; 
            font-size: 1.3rem; 
            color: #2d3748; 
            margin-top: 10px; 
            padding-top: 15px; 
        }
        .footer { 
            background: #2d3748; 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .footer p { margin-bottom: 10px; }
        .generated-by { 
            margin-top: 20px; 
            padding-top: 20px; 
            border-top: 1px solid #4a5568; 
            color: #a0aec0; 
            font-size: 0.9rem; 
        }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💼 QUOTATION</h1>
            <p>Professional Product Price Quotation</p>
        </div>
        
        <div class="quote-info">
            <div>
                <h3>Quote Information</h3>
                <p><strong>Quote #:</strong> ${document.getElementById('quoteNumber').textContent}</p>
                <p><strong>Date:</strong> ${document.getElementById('quoteDate').textContent}</p>
                <p><strong>Valid Until:</strong> ${document.getElementById('validDate').textContent}</p>
            </div>
            <div>
                <h3>Quote Summary</h3>
                <p><strong>Total Products:</strong> ${products.length}</p>
                <p><strong>Total Amount:</strong> ${formatCurrency(total)}</p>
                <p><strong>Status:</strong> <span style="color: #48bb78;">Active</span></p>
            </div>
        </div>
        
        <div class="products">
            <h2>📦 Product Details</h2>
            ${products.map((product, index) => `
                <div class="product">
                    <div class="product-header">
                        <h3>${index + 1}. ${product.name}</h3>
                        ${product.serialNumber ? `<div class="serial">Serial: ${product.serialNumber}</div>` : ''}
                    </div>
                    <div class="product-body">
                        <div class="product-details">
                            <div class="detail-item">
                                <div class="detail-label">Quantity</div>
                                <div class="detail-value">${product.quantity}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Unit Price</div>
                                <div class="detail-value">${formatCurrency(product.unitPrice)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Line Total</div>
                                <div class="detail-value" style="color: #48bb78;">${formatCurrency(product.total)}</div>
                            </div>
                            ${product.color ? `
                                <div class="detail-item">
                                    <div class="detail-label">Color</div>
                                    <div class="detail-value">
                                        <div class="color-display">
                                            <div class="color-dot" style="background-color: ${product.color};"></div>
                                            ${getColorName(product.color)}
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            ${product.photos && product.photos.length > 0 ? `
                                <div class="detail-item">
                                    <div class="detail-label">Photos</div>
                                    <div class="detail-value">${product.photos.length} image${product.photos.length > 1 ? 's' : ''}</div>
                                </div>
                            ` : ''}
                        </div>
                        ${product.description ? `<div class="description">${product.description}</div>` : ''}
                    </div>
                </div>
            `).join('')}
        </div>
        
        <div class="totals">
            <h2>💰 Financial Summary</h2>
            <div class="totals-grid">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span>${formatCurrency(subtotal)}</span>
                </div>
                ${discountRate > 0 ? `
                    <div class="total-row">
                        <span>Discount (${discountRate}%):</span>
                        <span style="color: #f56565;">-${formatCurrency(discountAmount)}</span>
                    </div>
                ` : ''}
                <div class="total-row">
                    <span>Tax (${taxRate}%):</span>
                    <span>${formatCurrency(taxAmount)}</span>
                </div>
                <div class="total-row">
                    <span>TOTAL AMOUNT:</span>
                    <span>${formatCurrency(total)}</span>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p><strong>Thank you for your business!</strong></p>
            <p>This quotation is valid until ${document.getElementById('validDate').textContent}</p>
            <p>Please contact us if you have any questions about this quote.</p>
            <div class="generated-by">
                Generated by ${appTitle} Professional on ${new Date().toLocaleString()}
            </div>
        </div>
    </div>
</body>
</html>`;

            downloadFile(htmlContent, `${appTitle}-${document.getElementById('quoteNumber').textContent}-Professional.html`, 'text/html');
            showDownloadNotification('Professional HTML form downloaded!');
        }

        function downloadAsText() {
            // Calculate totals
            const subtotal = products.reduce((sum, product) => sum + product.total, 0);
            const discountRate = parseFloat(document.getElementById('discount').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discountAmount = subtotal * (discountRate / 100);
            const afterDiscount = subtotal - discountAmount;
            const taxAmount = afterDiscount * (taxRate / 100);
            const total = afterDiscount + taxAmount;

            // Create detailed quote text
            let quoteText = `QUOTATION\n`;
            quoteText += `${'='.repeat(60)}\n`;
            quoteText += `Quote #: ${document.getElementById('quoteNumber').textContent}\n`;
            quoteText += `Date: ${document.getElementById('quoteDate').textContent}\n`;
            quoteText += `Valid Until: ${document.getElementById('validDate').textContent}\n`;
            quoteText += `Generated by: ${appTitle} Professional\n\n`;
            
            quoteText += `PRODUCT DETAILS:\n`;
            quoteText += `${'='.repeat(60)}\n`;

            products.forEach((product, index) => {
                quoteText += `${index + 1}. ${product.name}\n`;
                if (product.serialNumber) {
                    quoteText += `   Serial Number: ${product.serialNumber}\n`;
                }
                if (product.color) {
                    quoteText += `   Color: ${getColorName(product.color)} (${product.color})\n`;
                }
                if (product.photos && product.photos.length > 0) {
                    quoteText += `   Photos: ${product.photos.length} image${product.photos.length > 1 ? 's' : ''}\n`;
                }
                if (product.description) {
                    quoteText += `   Description: ${product.description}\n`;
                }
                quoteText += `   Quantity: ${product.quantity}\n`;
                quoteText += `   Unit Price: ${formatCurrency(product.unitPrice)}\n`;
                quoteText += `   Line Total: ${formatCurrency(product.total)}\n`;
                quoteText += `   ${'-'.repeat(40)}\n`;
            });

            quoteText += `\nFINANCIAL SUMMARY:\n`;
            quoteText += `${'='.repeat(60)}\n`;
            quoteText += `Subtotal: ${formatCurrency(subtotal)}\n`;
            if (discountRate > 0) {
                quoteText += `Discount (${discountRate}%): -${formatCurrency(discountAmount)}\n`;
            }
            quoteText += `Tax (${taxRate}%): ${formatCurrency(taxAmount)}\n`;
            quoteText += `${'='.repeat(60)}\n`;
            quoteText += `TOTAL AMOUNT: ${formatCurrency(total)}\n`;
            quoteText += `${'='.repeat(60)}\n\n`;
            
            quoteText += `Thank you for your business!\n`;
            quoteText += `This quote is valid until ${document.getElementById('validDate').textContent}\n`;

            downloadFile(quoteText, `${appTitle}-${document.getElementById('quoteNumber').textContent}-Simple.txt`, 'text/plain');
            showDownloadNotification('Simple text format downloaded!');
        }

        function downloadAsCSV() {
            // Calculate totals
            const subtotal = products.reduce((sum, product) => sum + product.total, 0);
            const discountRate = parseFloat(document.getElementById('discount').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discountAmount = subtotal * (discountRate / 100);
            const afterDiscount = subtotal - discountAmount;
            const taxAmount = afterDiscount * (taxRate / 100);
            const total = afterDiscount + taxAmount;

            let csvContent = `Quote Information\n`;
            csvContent += `Quote Number,${document.getElementById('quoteNumber').textContent}\n`;
            csvContent += `Date,${document.getElementById('quoteDate').textContent}\n`;
            csvContent += `Valid Until,${document.getElementById('validDate').textContent}\n`;
            csvContent += `Generated By,${appTitle} Professional\n\n`;
            
            csvContent += `Product Details\n`;
            csvContent += `Item,Product Name,Serial Number,Quantity,Unit Price,Total,Color,Photos,Description\n`;
            
            products.forEach((product, index) => {
                const colorName = product.color ? getColorName(product.color) : '';
                const photoCount = product.photos ? product.photos.length : 0;
                const description = product.description ? product.description.replace(/,/g, ';') : '';
                csvContent += `${index + 1},"${product.name}","${product.serialNumber || ''}",${product.quantity},${formatCurrency(product.unitPrice)},${formatCurrency(product.total)},"${colorName}",${photoCount},"${description}"\n`;
            });
            
            csvContent += `\nFinancial Summary\n`;
            csvContent += `Description,Amount\n`;
            csvContent += `Subtotal,${formatCurrency(subtotal)}\n`;
            if (discountRate > 0) {
                csvContent += `Discount (${discountRate}%),-${formatCurrency(discountAmount)}\n`;
            }
            csvContent += `Tax (${taxRate}%),${formatCurrency(taxAmount)}\n`;
            csvContent += `TOTAL AMOUNT,${formatCurrency(total)}\n`;

            downloadFile(csvContent, `${appTitle}-${document.getElementById('quoteNumber').textContent}-Data.csv`, 'text/csv');
            showDownloadNotification('Excel/CSV format downloaded!');
        }

        function downloadFile(content, filename, mimeType) {
            try {
                const blob = new Blob([content], { type: `${mimeType};charset=utf-8` });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            } catch (error) {
                alert('Error downloading file. Please try again.');
                console.error('Download error:', error);
            }
        }

        function downloadPDF() {
            if (products.length === 0) {
                alert('Please add at least one product before downloading PDF.');
                return;
            }

            // Calculate totals
            const subtotal = products.reduce((sum, product) => sum + product.total, 0);
            const discountRate = parseFloat(document.getElementById('discount').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discountAmount = subtotal * (discountRate / 100);
            const afterDiscount = subtotal - discountAmount;
            const taxAmount = afterDiscount * (taxRate / 100);
            const total = afterDiscount + taxAmount;

            // Create PDF-optimized HTML
            const pdfContent = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF - ${document.getElementById('quoteNumber').textContent}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            line-height: 1.4; 
            color: #333; 
            background: white;
            padding: 20px;
            font-size: 12pt;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 20px; 
            border: 2px solid #4f46e5; 
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; }
        .quote-info { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .quote-info div { 
            padding: 15px; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            background: #f9fafb;
        }
        .products { margin-bottom: 30px; }
        .products h2 { 
            margin-bottom: 20px; 
            border-bottom: 2px solid #4f46e5; 
            padding-bottom: 10px; 
            color: #1f2937;
        }
        .product { 
            border: 1px solid #e5e7eb; 
            margin-bottom: 15px; 
            padding: 15px; 
            border-radius: 8px;
            page-break-inside: avoid;
        }
        .product-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 10px; 
        }
        .product-name { font-weight: bold; font-size: 1.1rem; color: #1f2937; }
        .product-total { font-weight: bold; color: #059669; font-size: 1.2rem; }
        .product-details { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; 
            margin-bottom: 10px;
        }
        .product-photo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            float: right;
            margin-left: 15px;
        }
        .totals { 
            border: 2px solid #4f46e5; 
            padding: 20px; 
            border-radius: 10px; 
            background: #f8fafc;
        }
        .total-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid #e5e7eb; 
        }
        .total-row.final { 
            font-weight: bold; 
            font-size: 1.3rem; 
            border-bottom: 2px solid #4f46e5; 
            margin-top: 10px; 
            padding-top: 10px; 
            color: #1f2937;
        }
        .calculation-method {
            background: #dbeafe;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid #3b82f6;
            font-size: 0.9rem;
        }
        @media print {
            body { padding: 0; font-size: 10pt; }
            .container { max-width: none; }
            .product { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💼 ${appTitle}</h1>
            <h2>PROFESSIONAL QUOTATION</h2>
            <p>Quote #${document.getElementById('quoteNumber').textContent}</p>
        </div>
        
        <div class="quote-info">
            <div>
                <h3><strong>Quote Information</strong></h3>
                <p><strong>Date:</strong> ${document.getElementById('quoteDate').textContent}</p>
                <p><strong>Valid Until:</strong> ${document.getElementById('validDate').textContent}</p>
                <p><strong>Currency:</strong> ${currentCurrency}</p>
            </div>
            <div>
                <h3><strong>Summary</strong></h3>
                <p><strong>Total Products:</strong> ${products.length}</p>
                <p><strong>Total Quantity:</strong> ${products.reduce((sum, p) => sum + p.quantity, 0)}</p>
                <p><strong>Total Amount:</strong> ${formatCurrency(total)}</p>
            </div>
        </div>
        
        <div class="products">
            <h2>📦 Product Details</h2>
            ${products.map((product, index) => `
                <div class="product">
                    <div class="product-header">
                        <div>
                            <div class="product-name">${index + 1}. ${product.name}</div>
                            ${product.serialNumber ? `<div style="color: #6b7280; font-size: 0.9rem;">Serial: ${product.serialNumber}</div>` : ''}
                            ${product.calculationMethod ? `<div style="color: #3b82f6; font-size: 0.8rem;">Method: ${getCalculationMethodName(product.calculationMethod)}</div>` : ''}
                        </div>
                        <div style="text-align: right;">
                            ${product.photos && product.photos.length > 0 ? `<img src="${product.photos[0].data}" alt="${product.name}" class="product-photo">` : ''}
                            <div class="product-total">${formatCurrency(product.total)}</div>
                        </div>
                    </div>
                    <div class="product-details">
                        <div><strong>Quantity:</strong> ${product.quantity}</div>
                        <div><strong>Unit Price:</strong> ${formatCurrency(product.unitPrice)}</div>
                        <div><strong>Category:</strong> ${product.category || 'N/A'}</div>
                        <div><strong>Box Size:</strong> ${product.boxSize || 'N/A'}</div>
                    </div>
                    ${product.description ? `<div style="margin-top: 10px; padding: 8px; background: #f3f4f6; border-radius: 4px; font-style: italic;">${product.description}</div>` : ''}
                </div>
            `).join('')}
        </div>
        
        <div class="totals">
            <h2>💰 Financial Summary</h2>
            <div class="total-row">
                <span>Subtotal:</span>
                <span>${formatCurrency(subtotal)}</span>
            </div>
            ${discountAmount > 0 ? `
                <div class="total-row">
                    <span>Discount (${discountRate}%):</span>
                    <span style="color: #dc2626;">-${formatCurrency(discountAmount)}</span>
                </div>
            ` : ''}
            <div class="total-row">
                <span>Tax (${taxRate}%):</span>
                <span>${formatCurrency(taxAmount)}</span>
            </div>
            <div class="total-row final">
                <span>TOTAL AMOUNT:</span>
                <span>${formatCurrency(total)}</span>
            </div>
        </div>
        
        <div style="margin-top: 30px; text-align: center; color: #6b7280; border-top: 1px solid #e5e7eb; padding-top: 20px;">
            <p><strong>Thank you for your business!</strong></p>
            <p>Generated by ${appTitle} on ${new Date().toLocaleString()}</p>
        </div>
    </div>
</body>
</html>`;

            // Create and download PDF-ready HTML
            downloadFile(pdfContent, `${appTitle}-${document.getElementById('quoteNumber').textContent}-PDF.html`, 'text/html');
            showDownloadNotification('PDF-ready file downloaded! Open in browser and print to PDF.');
        }

        function showDownloadNotification(message = '📄 Quote downloaded successfully!') {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Data persistence functions
        function saveData() {
            const data = {
                products: products,
                quoteCounter: quoteCounter,
                serialCounter: serialCounter,
                taxRate: document.getElementById('taxRate').value,
                discount: document.getElementById('discount').value,
                calculationMethod: document.getElementById('calculationMethod').value,
                currentCurrency: currentCurrency,
                appTitle: appTitle
            };
            
            localStorage.setItem('quoteFlowData', JSON.stringify(data));
            showSaveIndicator();
        }

        function loadData() {
            const savedData = localStorage.getItem('quoteFlowData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    products = data.products || [];
                    quoteCounter = data.quoteCounter || 1;
                    serialCounter = data.serialCounter || 1;
                    currentCurrency = data.currentCurrency || 'USD';
                    appTitle = data.appTitle || 'QuoteFlow';
                    
                    if (data.taxRate) document.getElementById('taxRate').value = data.taxRate;
                    if (data.discount) document.getElementById('discount').value = data.discount;
                    if (data.calculationMethod) document.getElementById('calculationMethod').value = data.calculationMethod;
                    if (data.currentCurrency) document.getElementById('displayCurrency').value = data.currentCurrency;
                    if (data.appTitle) document.getElementById('appTitle').value = data.appTitle;
                    
                    document.getElementById('quoteNumber').textContent = `QF-2024-${String(quoteCounter).padStart(3, '0')}`;
                    
                    renderProducts();
                    updateTotals();
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Color helper functions
        function setPresetColor() {
            const preset = document.getElementById('colorPreset').value;
            if (preset) {
                document.getElementById('productColor').value = preset;
            }
        }

        function getColorName(hexColor) {
            const colorMap = {
                '#EF4444': 'Red',
                '#3B82F6': 'Blue', 
                '#10B981': 'Green',
                '#F59E0B': 'Yellow',
                '#8B5CF6': 'Purple',
                '#F97316': 'Orange',
                '#EC4899': 'Pink',
                '#6B7280': 'Gray',
                '#000000': 'Black',
                '#FFFFFF': 'White'
            };
            return colorMap[hexColor.toUpperCase()] || hexColor;
        }

        // Comprehensive color name to hex mapping
        const colorNameMap = {
            // Basic colors
            'red': '#EF4444', 'blue': '#3B82F6', 'green': '#10B981', 'yellow': '#F59E0B',
            'purple': '#8B5CF6', 'orange': '#F97316', 'pink': '#EC4899', 'gray': '#6B7280',
            'grey': '#6B7280', 'black': '#000000', 'white': '#FFFFFF',
            
            // Extended colors
            'crimson': '#DC143C', 'maroon': '#800000', 'darkred': '#8B0000', 'firebrick': '#B22222',
            'indianred': '#CD5C5C', 'lightcoral': '#F08080', 'salmon': '#FA8072', 'darksalmon': '#E9967A',
            'lightsalmon': '#FFA07A', 'coral': '#FF7F50', 'tomato': '#FF6347', 'orangered': '#FF4500',
            'gold': '#FFD700', 'darkgoldenrod': '#B8860B', 'goldenrod': '#DAA520', 'lightyellow': '#FFFFE0',
            'khaki': '#F0E68C', 'darkkhaki': '#BDB76B', 'olive': '#808000', 'olivedrab': '#6B8E23',
            'yellowgreen': '#9ACD32', 'darkolivegreen': '#556B2F', 'greenyellow': '#ADFF2F', 'chartreuse': '#7FFF00',
            'lawngreen': '#7CFC00', 'lime': '#00FF00', 'limegreen': '#32CD32', 'palegreen': '#98FB98',
            'lightgreen': '#90EE90', 'mediumspringgreen': '#00FA9A', 'springgreen': '#00FF7F', 'mediumseagreen': '#3CB371',
            'seagreen': '#2E8B57', 'forestgreen': '#228B22', 'darkgreen': '#006400', 'mediumaquamarine': '#66CDAA',
            'aqua': '#00FFFF', 'cyan': '#00FFFF', 'lightcyan': '#E0FFFF', 'paleturquoise': '#AFEEEE',
            'aquamarine': '#7FFFD4', 'turquoise': '#40E0D0', 'mediumturquoise': '#48D1CC', 'darkturquoise': '#00CED1',
            'cadetblue': '#5F9EA0', 'steelblue': '#4682B4', 'lightsteelblue': '#B0C4DE', 'powderblue': '#B0E0E6',
            'lightblue': '#ADD8E6', 'skyblue': '#87CEEB', 'lightskyblue': '#87CEFA', 'deepskyblue': '#00BFFF',
            'dodgerblue': '#1E90FF', 'cornflowerblue': '#6495ED', 'royalblue': '#4169E1', 'mediumblue': '#0000CD',
            'darkblue': '#00008B', 'navy': '#000080', 'midnightblue': '#191970', 'indigo': '#4B0082',
            'blueviolet': '#8A2BE2', 'darkviolet': '#9400D3', 'darkorchid': '#9932CC', 'mediumorchid': '#BA55D3',
            'thistle': '#D8BFD8', 'plum': '#DDA0DD', 'violet': '#EE82EE', 'magenta': '#FF00FF',
            'fuchsia': '#FF00FF', 'darkmagenta': '#8B008B', 'mediumvioletred': '#C71585', 'palevioletred': '#DB7093',
            'deeppink': '#FF1493', 'hotpink': '#FF69B4', 'lightpink': '#FFB6C1', 'rosybrown': '#BC8F8F',
            'brown': '#A52A2A', 'saddlebrown': '#8B4513', 'sienna': '#A0522D', 'chocolate': '#D2691E',
            'darkgoldenrod': '#B8860B', 'peru': '#CD853F', 'tan': '#D2B48C', 'burlywood': '#DEB887',
            'wheat': '#F5DEB3', 'navajowhite': '#FFDEAD', 'bisque': '#FFE4C4', 'blanchedalmond': '#FFEBCD',
            'cornsilk': '#FFF8DC', 'darkgray': '#A9A9A9', 'darkgrey': '#A9A9A9', 'dimgray': '#696969',
            'dimgrey': '#696969', 'lightgray': '#D3D3D3', 'lightgrey': '#D3D3D3', 'gainsboro': '#DCDCDC',
            'whitesmoke': '#F5F5F5', 'silver': '#C0C0C0'
        };

        function handleBulkColorInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target.value.trim();
                if (!input) return;
                
                const colorNames = input.split(',').map(name => name.trim().toLowerCase()).filter(name => name);
                const convertedColors = [];
                const unknownColors = [];
                
                colorNames.forEach(colorName => {
                    if (colorNameMap[colorName]) {
                        convertedColors.push({
                            name: colorName,
                            hex: colorNameMap[colorName]
                        });
                    } else {
                        unknownColors.push(colorName);
                    }
                });
                
                if (convertedColors.length > 0) {
                    // Set the first color as the main color
                    document.getElementById('productColor').value = convertedColors[0].hex;
                    
                    // Show conversion results
                    showColorConversionResults(convertedColors, unknownColors);
                    
                    // Clear the input
                    event.target.value = '';
                    hideSuggestions();
                } else {
                    showColorError('No valid color names found. Try: red, blue, green, etc.');
                }
            }
        }

        function showColorSuggestions(input) {
            const suggestions = document.getElementById('colorSuggestions');
            if (!input.trim()) {
                hideSuggestions();
                return;
            }
            
            const lastColor = input.split(',').pop().trim().toLowerCase();
            if (lastColor.length < 2) {
                hideSuggestions();
                return;
            }
            
            const matches = Object.keys(colorNameMap)
                .filter(color => color.includes(lastColor))
                .slice(0, 8);
            
            if (matches.length === 0) {
                hideSuggestions();
                return;
            }
            
            suggestions.innerHTML = matches.map(color => `
                <div class="px-3 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-2" 
                     onclick="selectSuggestedColor('${color}')">
                    <div class="w-4 h-4 rounded-full border border-gray-300" style="background-color: ${colorNameMap[color]}"></div>
                    <span class="text-gray-800 capitalize">${color}</span>
                    <span class="text-gray-500 text-xs ml-auto">${colorNameMap[color]}</span>
                </div>
            `).join('');
            
            suggestions.classList.remove('hidden');
        }

        function selectSuggestedColor(colorName) {
            const input = document.getElementById('bulkColorInput');
            const currentValue = input.value;
            const parts = currentValue.split(',');
            parts[parts.length - 1] = ' ' + colorName;
            input.value = parts.join(',');
            input.focus();
            hideSuggestions();
        }

        function hideSuggestions() {
            document.getElementById('colorSuggestions').classList.add('hidden');
        }

        function showColorConversionResults(convertedColors, unknownColors) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50 animate-slide-in max-w-sm';
            
            let content = `<div class="font-semibold mb-2">🎨 Colors Converted!</div>`;
            
            if (convertedColors.length > 0) {
                content += `<div class="space-y-1 mb-2">`;
                convertedColors.forEach(color => {
                    content += `
                        <div class="flex items-center gap-2 text-sm">
                            <div class="w-3 h-3 rounded-full border border-white/30" style="background-color: ${color.hex}"></div>
                            <span class="capitalize">${color.name}</span>
                            <span class="text-white/80">${color.hex}</span>
                        </div>
                    `;
                });
                content += `</div>`;
            }
            
            if (unknownColors.length > 0) {
                content += `<div class="text-yellow-200 text-xs">Unknown: ${unknownColors.join(', ')}</div>`;
            }
            
            notification.innerHTML = content;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showColorError(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#bulkColorInput') && !e.target.closest('#colorSuggestions')) {
                hideSuggestions();
            }
        });

        // Database functions
        function showDatabase() {
            const modal = document.getElementById('databaseModal');
            const content = document.getElementById('databaseContent');
            
            // Show the modal
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
            
            renderDatabaseContent();
        }

        function closeDatabaseModal() {
            const modal = document.getElementById('databaseModal');
            modal.style.display = 'none';
            modal.classList.add('hidden');
        }

        function renderDatabaseContent() {
            const content = document.getElementById('databaseContent');
            
            // Calculate statistics
            const totalProducts = products.length;
            const totalValue = products.reduce((sum, product) => sum + product.total, 0);
            const avgPrice = totalProducts > 0 ? totalValue / totalProducts : 0;
            const mostExpensive = totalProducts > 0 ? Math.max(...products.map(p => p.total)) : 0;
            const leastExpensive = totalProducts > 0 ? Math.min(...products.map(p => p.total)) : 0;
            
            // Get color statistics
            const colorStats = {};
            products.forEach(product => {
                if (product.color) {
                    const colorName = getColorName(product.color);
                    colorStats[colorName] = (colorStats[colorName] || 0) + 1;
                }
            });
            
            // Get all saved data
            const savedData = localStorage.getItem('quoteFlowData');
            let rawDataSize = 0;
            if (savedData) {
                rawDataSize = new Blob([savedData]).size;
            }
            
            content.innerHTML = `
                <!-- Database Controls -->
                <div class="mb-8 flex flex-wrap gap-4 justify-center">
                    <button onclick="exportAllData()" class="bg-gradient-to-r from-green-500/80 to-emerald-600/80 hover:from-green-600/90 hover:to-emerald-700/90 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 flex items-center gap-2 backdrop-blur-sm border border-white/20">
                        📤 Export All Data
                    </button>
                    <button onclick="importData()" class="bg-gradient-to-r from-blue-500/80 to-indigo-600/80 hover:from-blue-600/90 hover:to-indigo-700/90 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 flex items-center gap-2 backdrop-blur-sm border border-white/20">
                        📥 Import Data
                    </button>
                    <button onclick="clearAllData()" class="bg-gradient-to-r from-red-500/80 to-pink-600/80 hover:from-red-600/90 hover:to-pink-700/90 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 flex items-center gap-2 backdrop-blur-sm border border-white/20">
                        🗑️ Clear All Data
                    </button>
                    <button onclick="backupData()" class="bg-gradient-to-r from-purple-500/80 to-indigo-600/80 hover:from-purple-600/90 hover:to-indigo-700/90 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 flex items-center gap-2 backdrop-blur-sm border border-white/20">
                        💾 Backup Data
                    </button>
                </div>

                <div class="grid lg:grid-cols-2 gap-8 mb-8">
                    <!-- Statistics Panel -->
                    <div class="database-card rounded-2xl p-8">
                        <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                            📊 Current Quote Statistics
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Total Products:</span>
                                <span class="font-semibold text-blue-300 text-lg">${totalProducts}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Total Value:</span>
                                <span class="font-semibold text-green-300 text-lg">${formatCurrency(totalValue)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Average Price:</span>
                                <span class="font-semibold text-purple-300 text-lg">${formatCurrency(avgPrice)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Most Expensive:</span>
                                <span class="font-semibold text-red-300 text-lg">${formatCurrency(mostExpensive)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Least Expensive:</span>
                                <span class="font-semibold text-orange-300 text-lg">${formatCurrency(leastExpensive)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Quote Number:</span>
                                <span class="font-semibold text-indigo-300 text-lg">${document.getElementById('quoteNumber').textContent}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Data Size:</span>
                                <span class="font-semibold text-gray-300 text-lg">${(rawDataSize / 1024).toFixed(2)} KB</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Information -->
                    <div class="database-card rounded-2xl p-8">
                        <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                            ⚙️ System Information
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">App Name:</span>
                                <span class="font-semibold text-pink-300 text-lg">${appTitle}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Display Currency:</span>
                                <span class="font-semibold text-blue-300 text-lg">${currentCurrency}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Tax Rate:</span>
                                <span class="font-semibold text-blue-300 text-lg">${document.getElementById('taxRate').value}%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Discount Rate:</span>
                                <span class="font-semibold text-green-300 text-lg">${document.getElementById('discount').value}%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Serial Counter:</span>
                                <span class="font-semibold text-purple-300 text-lg">${serialCounter}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Quote Counter:</span>
                                <span class="font-semibold text-indigo-300 text-lg">${quoteCounter}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-white/80">Last Updated:</span>
                                <span class="font-semibold text-gray-300 text-lg">${new Date().toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Product Management -->
                <div class="database-card rounded-2xl p-8 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white flex items-center gap-3">
                            🛠️ Advanced Product Management
                        </h3>
                        <div class="flex gap-2">
                            <input type="text" id="dbSearchInput" placeholder="Search products..." 
                                   class="px-4 py-2 rounded-lg bg-white/20 border border-white/30 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 backdrop-blur-sm"
                                   oninput="filterDatabaseProducts(this.value)">
                            <select id="dbSortBy" onchange="sortDatabaseProducts(this.value)" 
                                    class="px-4 py-2 rounded-lg bg-white/20 border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-blue-400 backdrop-blur-sm">
                                <option value="name" style="background: rgba(0,0,0,0.8); color: white;">Sort by Name</option>
                                <option value="price" style="background: rgba(0,0,0,0.8); color: white;">Sort by Price</option>
                                <option value="quantity" style="background: rgba(0,0,0,0.8); color: white;">Sort by Quantity</option>
                                <option value="total" style="background: rgba(0,0,0,0.8); color: white;">Sort by Total</option>
                            </select>
                        </div>
                    </div>
                    
                    ${totalProducts > 0 ? `
                        <div class="space-y-4" id="databaseProductsList">
                            ${products.map((product, index) => `
                                <div class="database-product-item bg-white/10 rounded-xl p-4 border border-white/20 backdrop-blur-sm" data-product-id="${product.id}">
                                    <div class="flex items-center gap-4">
                                        ${product.photos && product.photos.length > 0 ? `
                                            <div class="flex-shrink-0">
                                                <img src="${product.photos[0].data}" alt="${product.name}" 
                                                     class="w-16 h-16 object-cover rounded-lg border border-white/30">
                                            </div>
                                        ` : ''}
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2 mb-2">
                                                <h4 class="font-semibold text-white text-lg">${product.name}</h4>
                                                ${product.color ? `<div class="w-4 h-4 rounded-full border border-white/30" style="background-color: ${product.color}"></div>` : ''}
                                            </div>
                                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-white/80">
                                                <div><strong>Serial:</strong> ${product.serialNumber || 'N/A'}</div>
                                                <div><strong>Qty:</strong> ${product.quantity}</div>
                                                <div><strong>Unit:</strong> ${formatCurrency(product.unitPrice)}</div>
                                                <div><strong>Total:</strong> ${formatCurrency(product.total)}</div>
                                            </div>
                                            ${product.description ? `<div class="text-white/70 text-sm mt-2">${product.description}</div>` : ''}
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <button onclick="editProductFromDB(${product.id})" 
                                                    class="bg-blue-500/80 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-lg transition-colors flex items-center gap-1 backdrop-blur-sm">
                                                ✏️ Edit
                                            </button>
                                            <button onclick="duplicateProduct(${product.id})" 
                                                    class="bg-green-500/80 hover:bg-green-600 text-white text-sm px-4 py-2 rounded-lg transition-colors flex items-center gap-1 backdrop-blur-sm">
                                                📋 Duplicate
                                            </button>
                                            <button onclick="deleteProductFromDB(${product.id})" 
                                                    class="bg-red-500/80 hover:bg-red-600 text-white text-sm px-4 py-2 rounded-lg transition-colors flex items-center gap-1 backdrop-blur-sm">
                                                🗑️ Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Bulk Actions -->
                        <div class="mt-6 pt-6 border-t border-white/20">
                            <h4 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                                ⚡ Bulk Actions
                            </h4>
                            <div class="flex flex-wrap gap-3">
                                <button onclick="selectAllProducts()" class="bg-indigo-500/80 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm transition-colors backdrop-blur-sm">
                                    ☑️ Select All
                                </button>
                                <button onclick="deselectAllProducts()" class="bg-gray-500/80 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors backdrop-blur-sm">
                                    ☐ Deselect All
                                </button>
                                <button onclick="bulkDeleteSelected()" class="bg-red-500/80 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-colors backdrop-blur-sm">
                                    🗑️ Delete Selected
                                </button>
                                <button onclick="bulkExportSelected()" class="bg-green-500/80 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm transition-colors backdrop-blur-sm">
                                    📤 Export Selected
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div class="text-center py-12 text-white/60">
                            <div class="text-6xl mb-4">📦</div>
                            <p class="text-lg">No products in database</p>
                            <p class="text-sm">Add some products to see them here</p>
                        </div>
                    `}
                </div>
                
                ${Object.keys(colorStats).length > 0 ? `
                <!-- Color Statistics -->
                <div class="database-card rounded-2xl p-8">
                    <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                        🎨 Color Distribution
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                        ${Object.entries(colorStats).map(([color, count]) => `
                            <div class="database-card rounded-xl p-4 text-center">
                                <div class="text-3xl mb-2">${getColorEmoji(color)}</div>
                                <div class="font-semibold text-white">${color}</div>
                                <div class="text-sm text-white/70">${count} product${count > 1 ? 's' : ''}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
        }

        function getColorEmoji(colorName) {
            const emojiMap = {
                'Red': '🔴', 'Blue': '🔵', 'Green': '🟢', 'Yellow': '🟡',
                'Purple': '🟣', 'Orange': '🟠', 'Pink': '🩷', 'Gray': '⚫',
                'Black': '⚫', 'White': '⚪'
            };
            return emojiMap[colorName] || '🎨';
        }

        // Calculator functions
        let calcExpression = '';
        let calcDisplay = '0';

        function showCalculator() {
            document.getElementById('calculatorModal').style.display = 'flex';
            document.getElementById('calculatorModal').classList.remove('hidden');
        }

        function closeCalculatorModal() {
            document.getElementById('calculatorModal').style.display = 'none';
            document.getElementById('calculatorModal').classList.add('hidden');
        }

        function calcInput(value) {
            if (calcDisplay === '0' && !isNaN(value)) {
                calcDisplay = value;
                calcExpression = value;
            } else {
                calcDisplay += value;
                calcExpression += value;
            }
            document.getElementById('calcDisplay').textContent = calcDisplay;
        }

        function clearCalc() {
            calcDisplay = '0';
            calcExpression = '';
            document.getElementById('calcDisplay').textContent = calcDisplay;
        }

        function calcBackspace() {
            if (calcDisplay.length > 1) {
                calcDisplay = calcDisplay.slice(0, -1);
                calcExpression = calcExpression.slice(0, -1);
            } else {
                calcDisplay = '0';
                calcExpression = '';
            }
            document.getElementById('calcDisplay').textContent = calcDisplay;
        }

        function calcEquals() {
            try {
                // Replace display operators with JavaScript operators
                let expression = calcExpression.replace(/×/g, '*').replace(/÷/g, '/');
                let result = eval(expression);
                calcDisplay = result.toString();
                calcExpression = result.toString();
                document.getElementById('calcDisplay').textContent = calcDisplay;
            } catch (error) {
                calcDisplay = 'Error';
                document.getElementById('calcDisplay').textContent = calcDisplay;
                setTimeout(() => {
                    clearCalc();
                }, 2000);
            }
        }

        function useCalcResult(field) {
            const result = parseFloat(calcDisplay);
            if (!isNaN(result)) {
                if (field === 'unitPrice') {
                    document.getElementById('unitPrice').value = result.toFixed(2);
                } else if (field === 'quantity') {
                    document.getElementById('quantity').value = Math.round(result);
                }
                closeCalculatorModal();
            }
        }

        // Currency converter functions
        const exchangeRates = {
            'USD': 1.0, 'EUR': 0.85, 'GBP': 0.73, 'JPY': 110.0, 'CAD': 1.25,
            'AUD': 1.35, 'CHF': 0.92, 'CNY': 6.45, 'INR': 74.5, 'BRL': 5.2, 'BDT': 85.0
        };

        function showCurrencyConverter() {
            document.getElementById('currencyModal').style.display = 'flex';
            document.getElementById('currencyModal').classList.remove('hidden');
        }

        function closeCurrencyModal() {
            document.getElementById('currencyModal').style.display = 'none';
            document.getElementById('currencyModal').classList.add('hidden');
        }

        function convertCurrency() {
            const amount = parseFloat(document.getElementById('convertAmount').value) || 0;
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;
            
            if (amount === 0) {
                document.getElementById('convertedAmount').textContent = '0.00';
                document.getElementById('exchangeRate').textContent = 'Enter an amount to convert';
                return;
            }
            
            // Convert to USD first, then to target currency
            const usdAmount = amount / exchangeRates[fromCurrency];
            const convertedAmount = usdAmount * exchangeRates[toCurrency];
            
            document.getElementById('convertedAmount').textContent = convertedAmount.toFixed(2);
            
            const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
            document.getElementById('exchangeRate').textContent = `1 ${fromCurrency} = ${rate.toFixed(4)} ${toCurrency}`;
        }

        function swapCurrencies() {
            const fromSelect = document.getElementById('fromCurrency');
            const toSelect = document.getElementById('toCurrency');
            
            const temp = fromSelect.value;
            fromSelect.value = toSelect.value;
            toSelect.value = temp;
            
            convertCurrency();
        }

        function useConvertedAmount() {
            const convertedAmount = parseFloat(document.getElementById('convertedAmount').textContent);
            if (!isNaN(convertedAmount)) {
                document.getElementById('unitPrice').value = convertedAmount.toFixed(2);
                closeCurrencyModal();
            }
        }



        // Advanced Database Functions
        function exportAllData() {
            const data = {
                products: products,
                settings: {
                    appTitle: appTitle,
                    currentCurrency: currentCurrency,
                    taxRate: document.getElementById('taxRate').value,
                    discount: document.getElementById('discount').value,
                    quoteCounter: quoteCounter,
                    serialCounter: serialCounter
                },
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            downloadFile(jsonData, `${appTitle}-Complete-Export-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showDatabaseNotification('All data exported successfully!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('This will replace all current data. Are you sure?')) {
                            if (data.products) products = data.products;
                            if (data.settings) {
                                appTitle = data.settings.appTitle || appTitle;
                                currentCurrency = data.settings.currentCurrency || currentCurrency;
                                quoteCounter = data.settings.quoteCounter || quoteCounter;
                                serialCounter = data.settings.serialCounter || serialCounter;
                                
                                document.getElementById('appTitle').value = appTitle;
                                document.getElementById('displayCurrency').value = currentCurrency;
                                document.getElementById('taxRate').value = data.settings.taxRate || '8.5';
                                document.getElementById('discount').value = data.settings.discount || '0';
                            }
                            
                            renderProducts();
                            updateTotals();
                            updateRealTimeStats();
                            saveData();
                            renderDatabaseContent();
                            showDatabaseNotification('Data imported successfully!');
                        }
                    } catch (error) {
                        alert('Error importing data. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('This will permanently delete ALL data including products, settings, and counters. This action cannot be undone. Are you sure?')) {
                if (confirm('Last chance! This will delete everything. Continue?')) {
                    localStorage.removeItem('quoteFlowData');
                    products = [];
                    quoteCounter = 1;
                    serialCounter = 1;
                    editingProductId = null;
                    
                    // Reset form
                    document.getElementById('appTitle').value = 'QuoteFlow';
                    document.getElementById('displayCurrency').value = 'USD';
                    document.getElementById('taxRate').value = '8.5';
                    document.getElementById('discount').value = '0';
                    
                    appTitle = 'QuoteFlow';
                    currentCurrency = 'USD';
                    
                    renderProducts();
                    updateTotals();
                    updateRealTimeStats();
                    renderDatabaseContent();
                    showDatabaseNotification('All data cleared successfully!');
                }
            }
        }

        function backupData() {
            const data = {
                products: products,
                settings: {
                    appTitle: appTitle,
                    currentCurrency: currentCurrency,
                    taxRate: document.getElementById('taxRate').value,
                    discount: document.getElementById('discount').value,
                    quoteCounter: quoteCounter,
                    serialCounter: serialCounter
                },
                backupDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            downloadFile(jsonData, `${appTitle}-Backup-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showDatabaseNotification('Backup created successfully!');
        }

        function editProductFromDB(id) {
            editProduct(id);
            closeDatabaseModal();
        }

        function deleteProductFromDB(id) {
            removeProduct(id);
            renderDatabaseContent();
        }

        function duplicateProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            const duplicatedProduct = {
                ...product,
                id: Date.now(),
                name: product.name + ' (Copy)',
                serialNumber: generateAutoSerialNumber()
            };
            
            products.push(duplicatedProduct);
            renderProducts();
            updateTotals();
            updateRealTimeStats();
            saveData();
            renderDatabaseContent();
            showDatabaseNotification(`"${product.name}" duplicated successfully!`);
        }

        function filterDatabaseProducts(query) {
            const items = document.querySelectorAll('.database-product-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function sortDatabaseProducts(sortBy) {
            const container = document.getElementById('databaseProductsList');
            if (!container) return;
            
            const items = Array.from(container.children);
            
            items.sort((a, b) => {
                const idA = parseInt(a.dataset.productId);
                const idB = parseInt(b.dataset.productId);
                const productA = products.find(p => p.id === idA);
                const productB = products.find(p => p.id === idB);
                
                if (!productA || !productB) return 0;
                
                switch (sortBy) {
                    case 'name':
                        return productA.name.localeCompare(productB.name);
                    case 'price':
                        return productA.unitPrice - productB.unitPrice;
                    case 'quantity':
                        return productA.quantity - productB.quantity;
                    case 'total':
                        return productA.total - productB.total;
                    default:
                        return 0;
                }
            });
            
            items.forEach(item => container.appendChild(item));
        }

        function selectAllProducts() {
            // Add checkboxes if they don't exist
            const items = document.querySelectorAll('.database-product-item');
            items.forEach(item => {
                if (!item.querySelector('.product-checkbox')) {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'product-checkbox mr-3';
                    checkbox.checked = true;
                    item.querySelector('.flex').insertBefore(checkbox, item.querySelector('.flex').firstChild);
                }
            });
        }

        function deselectAllProducts() {
            const checkboxes = document.querySelectorAll('.product-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function bulkDeleteSelected() {
            const checkboxes = document.querySelectorAll('.product-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('No products selected for deletion.');
                return;
            }
            
            if (confirm(`Delete ${checkboxes.length} selected product(s)?`)) {
                const idsToDelete = [];
                checkboxes.forEach(checkbox => {
                    const item = checkbox.closest('.database-product-item');
                    idsToDelete.push(parseInt(item.dataset.productId));
                });
                
                products = products.filter(product => !idsToDelete.includes(product.id));
                
                renderProducts();
                updateTotals();
                updateRealTimeStats();
                saveData();
                renderDatabaseContent();
                showDatabaseNotification(`${idsToDelete.length} product(s) deleted successfully!`);
            }
        }

        function bulkExportSelected() {
            const checkboxes = document.querySelectorAll('.product-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('No products selected for export.');
                return;
            }
            
            const selectedProducts = [];
            checkboxes.forEach(checkbox => {
                const item = checkbox.closest('.database-product-item');
                const productId = parseInt(item.dataset.productId);
                const product = products.find(p => p.id === productId);
                if (product) selectedProducts.push(product);
            });
            
            const exportData = {
                products: selectedProducts,
                exportDate: new Date().toISOString(),
                count: selectedProducts.length
            };
            
            const jsonData = JSON.stringify(exportData, null, 2);
            downloadFile(jsonData, `${appTitle}-Selected-Products-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            showDatabaseNotification(`${selectedProducts.length} selected product(s) exported!`);
        }

        function showDatabaseNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-indigo-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Search functionality
        function searchProducts(query) {
            const productCards = document.querySelectorAll('.product-card');
            const searchTerm = query.toLowerCase().trim();
            
            if (!searchTerm) {
                // Show all products if search is empty
                productCards.forEach(card => {
                    card.style.display = 'block';
                });
                return;
            }
            
            productCards.forEach(card => {
                const productText = card.textContent.toLowerCase();
                if (productText.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            searchProducts(''); // Show all products
        }

        // Product Details Modal Functions
        function showProductDetails(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            const modal = document.getElementById('productDetailsModal');
            const content = document.getElementById('productDetailsContent');
            
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Product Header -->
                    <div class="text-center">
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">${product.name}</h3>
                        ${product.serialNumber ? `<p class="text-blue-600 font-medium">Serial: ${product.serialNumber}</p>` : ''}
                    </div>
                    
                    <!-- Photo Gallery -->
                    ${product.photos && product.photos.length > 0 ? `
                        <div class="bg-gray-50 rounded-xl p-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                📷 Product Photos (${product.photos.length})
                            </h4>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                ${product.photos.map((photo, index) => `
                                    <div class="relative group">
                                        <img src="${photo.data}" alt="${photo.name}" 
                                             class="w-full h-32 object-cover rounded-lg border border-gray-200 cursor-pointer hover:shadow-lg transition-shadow"
                                             onclick="showFullImage('${photo.data}', '${photo.name}')">
                                        <div class="absolute bottom-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded">
                                            ${index + 1}/${product.photos.length}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Product Information Grid -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Basic Information -->
                        <div class="bg-blue-50 rounded-xl p-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                📋 Basic Information
                            </h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Product Name:</span>
                                    <span class="font-medium text-gray-800">${product.name}</span>
                                </div>
                                ${product.serialNumber ? `
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Serial Number:</span>
                                        <span class="font-medium text-blue-600">${product.serialNumber}</span>
                                    </div>
                                ` : ''}
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Quantity:</span>
                                    <span class="font-medium text-gray-800">${product.quantity}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Unit Price:</span>
                                    <span class="font-medium text-green-600">${formatCurrency(product.unitPrice)}</span>
                                </div>
                                <div class="flex justify-between border-t pt-2">
                                    <span class="text-gray-600 font-medium">Line Total:</span>
                                    <span class="font-bold text-green-600 text-lg">${formatCurrency(product.total)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Details -->
                        <div class="bg-green-50 rounded-xl p-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                ⚡ Additional Details
                            </h4>
                            <div class="space-y-3">
                                ${product.color ? `
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Color:</span>
                                        <div class="flex items-center gap-2">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300" style="background-color: ${product.color}"></div>
                                            <span class="font-medium text-gray-800">${getColorName(product.color)}</span>
                                            <span class="text-sm text-gray-500">${product.color}</span>
                                        </div>
                                    </div>
                                ` : ''}
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Photos:</span>
                                    <span class="font-medium text-gray-800">${product.photos ? product.photos.length : 0} image${(product.photos && product.photos.length !== 1) ? 's' : ''}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Added:</span>
                                    <span class="font-medium text-gray-800">${new Date(product.id).toLocaleDateString()}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Product ID:</span>
                                    <span class="font-medium text-gray-500 text-sm">#${product.id}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    ${product.description ? `
                        <div class="bg-purple-50 rounded-xl p-4">
                            <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                📝 Description
                            </h4>
                            <p class="text-gray-700 leading-relaxed">${product.description}</p>
                        </div>
                    ` : ''}
                    
                    <!-- Action Buttons -->
                    <div class="flex gap-3 pt-4 border-t">
                        <button onclick="editProduct(${product.id}); closeProductDetailsModal();" 
                                class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2">
                            ✏️ Edit Product
                        </button>
                        <button onclick="duplicateProduct(${product.id}); closeProductDetailsModal();" 
                                class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2">
                            📋 Duplicate
                        </button>
                        <button onclick="removeProduct(${product.id}); closeProductDetailsModal();" 
                                class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2">
                            🗑️ Delete
                        </button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            modal.classList.remove('hidden');
        }

        function closeProductDetailsModal() {
            const modal = document.getElementById('productDetailsModal');
            modal.style.display = 'none';
            modal.classList.add('hidden');
        }

        function showFullImage(src, name) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${src}" alt="${name}" class="max-w-full max-h-full object-contain rounded-lg">
                    <button onclick="this.closest('.fixed').remove()" 
                            class="absolute top-4 right-4 bg-white/20 hover:bg-white/30 text-white rounded-full w-10 h-10 flex items-center justify-center transition-colors">
                        ✕
                    </button>
                    <div class="absolute bottom-4 left-4 bg-black/70 text-white px-3 py-2 rounded-lg">
                        ${name}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Close on click outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Quick discount and tax update functions
        function updateQuickDiscount() {
            const quickDiscount = document.getElementById('quickDiscount').value;
            document.getElementById('discount').value = quickDiscount;
        }

        function updateQuickTax() {
            const quickTax = document.getElementById('quickTax').value;
            document.getElementById('taxRate').value = quickTax;
        }

        // Initialize quick controls on load
        document.addEventListener('DOMContentLoaded', function() {
            // Sync quick controls with main controls
            const taxRate = document.getElementById('taxRate').value;
            const discount = document.getElementById('discount').value;
            
            if (document.getElementById('quickTax')) {
                document.getElementById('quickTax').value = taxRate;
            }
            if (document.getElementById('quickDiscount')) {
                document.getElementById('quickDiscount').value = discount;
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9761899617bc9b59',t:'MTc1NjM2MDI5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
